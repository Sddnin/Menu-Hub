-- Mila UI V4.0
-- Created by: Mila
-- New: Dark Mode, Themes, Save Settings, Favorites

local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local CoreGui = game:GetService("CoreGui")

local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local humanoid = character:WaitForChild("Humanoid")

-- Variables
local noclip = false
local infiniteJump = false
local antiAFK = false
local esp = false
local fullbright = false
local jumpConnection = nil
local afkConnection = nil
local espConnection = nil
local darkMode = false
local currentTheme = "Blue"

-- Create ScreenGui
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "MilaUI"
screenGui.ResetOnSpawn = false
screenGui.Parent = CoreGui

-- Main Frame
local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(0, 350, 0, 250)
mainFrame.Position = UDim2.new(0.5, -175, 0.5, -125)
mainFrame.BackgroundColor3 = Color3.fromRGB(250, 250, 252)
mainFrame.BorderSizePixel = 0
mainFrame.Active = true
mainFrame.Draggable = true
mainFrame.Parent = screenGui

local mainCorner = Instance.new("UICorner")
mainCorner.CornerRadius = UDim.new(0, 15)
mainCorner.Parent = mainFrame

-- Background Frame
local bgFrame = Instance.new("Frame")
bgFrame.Size = UDim2.new(1, 20, 1, 20)
bgFrame.Position = UDim2.new(0, -10, 0, -10)
bgFrame.ZIndex = 0
bgFrame.Parent = mainFrame

local bgCorner = Instance.new("UICorner")
bgCorner.CornerRadius = UDim.new(0, 20)
bgCorner.Parent = bgFrame

local bgGradient = Instance.new("UIGradient")
bgGradient.Color = ColorSequence.new{
    ColorSequenceKeypoint.new(0, Color3.fromRGB(25, 76, 204)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(76, 153, 255))
}
bgGradient.Rotation = 135
bgGradient.Parent = bgFrame

-- Close Button
local closeBtn = Instance.new("TextButton")
closeBtn.Size = UDim2.new(0, 20, 0, 20)
closeBtn.Position = UDim2.new(1, -25, 0, 5)
closeBtn.BackgroundColor3 = Color3.fromRGB(230, 100, 100)
closeBtn.Text = "‚úï"
closeBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
closeBtn.TextSize = 12
closeBtn.Font = Enum.Font.GothamBold
closeBtn.ZIndex = 2
closeBtn.Parent = mainFrame

local closeBtnCorner = Instance.new("UICorner")
closeBtnCorner.CornerRadius = UDim.new(1, 0)
closeBtnCorner.Parent = closeBtn

-- Toggle Button
local toggleButton = Instance.new("TextButton")
toggleButton.Size = UDim2.new(0, 80, 0, 30)
toggleButton.Position = UDim2.new(0, 10, 0, 10)
toggleButton.BackgroundColor3 = Color3.fromRGB(217, 102, 102)
toggleButton.Text = "Mila üíñ"
toggleButton.TextColor3 = Color3.fromRGB(255, 255, 255)
toggleButton.TextSize = 12
toggleButton.Font = Enum.Font.Gotham
toggleButton.Visible = false
toggleButton.Parent = screenGui

local toggleCorner = Instance.new("UICorner")
toggleCorner.CornerRadius = UDim.new(0, 10)
toggleCorner.Parent = toggleButton

-- Tabs
local tabFrame = Instance.new("Frame")
tabFrame.Size = UDim2.new(1, -20, 0, 35)
tabFrame.Position = UDim2.new(0, 10, 0, 15)
tabFrame.BackgroundTransparency = 1
tabFrame.ZIndex = 2
tabFrame.Parent = mainFrame

-- Version Label
local versionLabel = Instance.new("TextLabel")
versionLabel.Size = UDim2.new(0, 50, 0, 15)
versionLabel.Position = UDim2.new(1, -55, 0, -20)
versionLabel.BackgroundTransparency = 1
versionLabel.Text = "V4.0"
versionLabel.TextColor3 = Color3.fromRGB(255, 215, 0)
versionLabel.TextSize = 10
versionLabel.Font = Enum.Font.GothamBold
versionLabel.ZIndex = 3
versionLabel.Parent = mainFrame

local homeTab = Instance.new("TextButton")
homeTab.Size = UDim2.new(0.33, -5, 1, 0)
homeTab.Position = UDim2.new(0, 0, 0, 0)
homeTab.BackgroundColor3 = Color3.fromRGB(51, 102, 204)
homeTab.Text = "Home"
homeTab.TextColor3 = Color3.fromRGB(255, 255, 255)
homeTab.TextSize = 11
homeTab.Font = Enum.Font.Gotham
homeTab.ZIndex = 2
homeTab.Parent = tabFrame

local homeCorner = Instance.new("UICorner")
homeCorner.CornerRadius = UDim.new(0, 8)
homeCorner.Parent = homeTab

local scriptTab = Instance.new("TextButton")
scriptTab.Size = UDim2.new(0.33, -5, 1, 0)
scriptTab.Position = UDim2.new(0.33, 2.5, 0, 0)
scriptTab.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
scriptTab.Text = "Script"
scriptTab.TextColor3 = Color3.fromRGB(128, 128, 128)
scriptTab.TextSize = 11
scriptTab.Font = Enum.Font.Gotham
scriptTab.ZIndex = 2
scriptTab.Parent = tabFrame

local scriptCorner = Instance.new("UICorner")
scriptCorner.CornerRadius = UDim.new(0, 8)
scriptCorner.Parent = scriptTab

local otherTab = Instance.new("TextButton")
otherTab.Size = UDim2.new(0.33, -5, 1, 0)
otherTab.Position = UDim2.new(0.66, 5, 0, 0)
otherTab.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
otherTab.Text = "Other"
otherTab.TextColor3 = Color3.fromRGB(128, 128, 128)
otherTab.TextSize = 11
otherTab.Font = Enum.Font.Gotham
otherTab.ZIndex = 2
otherTab.Parent = tabFrame

local otherCorner = Instance.new("UICorner")
otherCorner.CornerRadius = UDim.new(0, 8)
otherCorner.Parent = otherTab

local settingsTab = Instance.new("TextButton")
settingsTab.Size = UDim2.new(0, 30, 0, 35)
settingsTab.Position = UDim2.new(1, -35, 0, 0)
settingsTab.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
settingsTab.Text = "‚öôÔ∏è"
settingsTab.TextColor3 = Color3.fromRGB(128, 128, 128)
settingsTab.TextSize = 14
settingsTab.Font = Enum.Font.Gotham
settingsTab.ZIndex = 2
settingsTab.Parent = tabFrame

local settingsCorner = Instance.new("UICorner")
settingsCorner.CornerRadius = UDim.new(0, 8)
settingsCorner.Parent = settingsTab

-- Content Area
local contentArea = Instance.new("Frame")
contentArea.Size = UDim2.new(1, -20, 1, -65)
contentArea.Position = UDim2.new(0, 10, 0, 55)
contentArea.BackgroundTransparency = 1
contentArea.ZIndex = 1
contentArea.Parent = mainFrame

-- Home Content
local homeContent = Instance.new("ScrollingFrame")
homeContent.Size = UDim2.new(1, 0, 1, 0)
homeContent.BackgroundTransparency = 1
homeContent.ScrollBarThickness = 4
homeContent.CanvasSize = UDim2.new(0, 0, 0, 350)
homeContent.ZIndex = 1
homeContent.Parent = contentArea

-- Script Content
local scriptContent = Instance.new("ScrollingFrame")
scriptContent.Size = UDim2.new(1, 0, 1, 0)
scriptContent.BackgroundTransparency = 1
scriptContent.ScrollBarThickness = 4
scriptContent.CanvasSize = UDim2.new(0, 0, 0, 600)
scriptContent.Visible = false
scriptContent.ZIndex = 1
scriptContent.Parent = contentArea

-- Other Content
local otherContent = Instance.new("ScrollingFrame")
otherContent.Size = UDim2.new(1, 0, 1, 0)
otherContent.BackgroundTransparency = 1
otherContent.ScrollBarThickness = 4
otherContent.CanvasSize = UDim2.new(0, 0, 0, 450)
otherContent.Visible = false
otherContent.ZIndex = 1
otherContent.Parent = contentArea

-- Settings Content
local settingsContent = Instance.new("ScrollingFrame")
settingsContent.Size = UDim2.new(1, 0, 1, 0)
settingsContent.BackgroundTransparency = 1
settingsContent.ScrollBarThickness = 4
settingsContent.CanvasSize = UDim2.new(0, 0, 0, 300)
settingsContent.Visible = false
settingsContent.ZIndex = 1
settingsContent.Parent = contentArea

-- Settings Header
local settingsHeader = Instance.new("TextLabel")
settingsHeader.Size = UDim2.new(1, 0, 0, 30)
settingsHeader.Position = UDim2.new(0, 0, 0, 5)
settingsHeader.BackgroundTransparency = 1
settingsHeader.Text = "‚öôÔ∏è Settings - V4.0"
settingsHeader.TextColor3 = Color3.fromRGB(51, 51, 51)
settingsHeader.TextSize = 14
settingsHeader.Font = Enum.Font.GothamBold
settingsHeader.TextXAlignment = Enum.TextXAlignment.Left
settingsHeader.ZIndex = 2
settingsHeader.Parent = settingsContent

-- Dark Mode Toggle
local darkModeFrame = Instance.new("Frame")
darkModeFrame.Size = UDim2.new(1, -10, 0, 50)
darkModeFrame.Position = UDim2.new(0, 5, 0, 40)
darkModeFrame.BackgroundColor3 = Color3.fromRGB(240, 240, 240)
darkModeFrame.BorderSizePixel = 0
darkModeFrame.ZIndex = 2
darkModeFrame.Parent = settingsContent

local darkModeCorner = Instance.new("UICorner")
darkModeCorner.CornerRadius = UDim.new(0, 8)
darkModeCorner.Parent = darkModeFrame

local darkModeLabel = Instance.new("TextLabel")
darkModeLabel.Size = UDim2.new(0, 200, 0, 50)
darkModeLabel.Position = UDim2.new(0, 10, 0, 0)
darkModeLabel.BackgroundTransparency = 1
darkModeLabel.Text = "üåô Dark Mode"
darkModeLabel.TextColor3 = Color3.fromRGB(51, 51, 51)
darkModeLabel.TextSize = 12
darkModeLabel.Font = Enum.Font.GothamBold
darkModeLabel.TextXAlignment = Enum.TextXAlignment.Left
darkModeLabel.ZIndex = 3
darkModeLabel.Parent = darkModeFrame

local darkModeToggle = Instance.new("TextButton")
darkModeToggle.Size = UDim2.new(0, 80, 0, 30)
darkModeToggle.Position = UDim2.new(1, -90, 0, 10)
darkModeToggle.BackgroundColor3 = Color3.fromRGB(200, 200, 200)
darkModeToggle.Text = "OFF"
darkModeToggle.TextColor3 = Color3.fromRGB(51, 51, 51)
darkModeToggle.TextSize = 11
darkModeToggle.Font = Enum.Font.GothamBold
darkModeToggle.ZIndex = 3
darkModeToggle.Parent = darkModeFrame

local darkModeToggleCorner = Instance.new("UICorner")
darkModeToggleCorner.CornerRadius = UDim.new(0, 6)
darkModeToggleCorner.Parent = darkModeToggle

-- Theme Selector
local themeFrame = Instance.new("Frame")
themeFrame.Size = UDim2.new(1, -10, 0, 80)
themeFrame.Position = UDim2.new(0, 5, 0, 100)
themeFrame.BackgroundColor3 = Color3.fromRGB(240, 240, 240)
themeFrame.BorderSizePixel = 0
themeFrame.ZIndex = 2
themeFrame.Parent = settingsContent

local themeFrameCorner = Instance.new("UICorner")
themeFrameCorner.CornerRadius = UDim.new(0, 8)
themeFrameCorner.Parent = themeFrame

local themeLabel = Instance.new("TextLabel")
themeLabel.Size = UDim2.new(1, -20, 0, 25)
themeLabel.Position = UDim2.new(0, 10, 0, 5)
themeLabel.BackgroundTransparency = 1
themeLabel.Text = "üé® Theme Colors"
themeLabel.TextColor3 = Color3.fromRGB(51, 51, 51)
themeLabel.TextSize = 12
themeLabel.Font = Enum.Font.GothamBold
themeLabel.TextXAlignment = Enum.TextXAlignment.Left
themeLabel.ZIndex = 3
themeLabel.Parent = themeFrame

local themes = {
    {name = "Blue", color = Color3.fromRGB(51, 102, 204), gradient1 = Color3.fromRGB(25, 76, 204), gradient2 = Color3.fromRGB(76, 153, 255)},
    {name = "Purple", color = Color3.fromRGB(147, 51, 234), gradient1 = Color3.fromRGB(107, 33, 168), gradient2 = Color3.fromRGB(167, 85, 221)},
    {name = "Pink", color = Color3.fromRGB(236, 72, 153), gradient1 = Color3.fromRGB(219, 39, 119), gradient2 = Color3.fromRGB(244, 114, 182)},
    {name = "Green", color = Color3.fromRGB(34, 197, 94), gradient1 = Color3.fromRGB(22, 163, 74), gradient2 = Color3.fromRGB(74, 222, 128)}
}

local themeButtons = {}
for i, theme in ipairs(themes) do
    local themeBtn = Instance.new("TextButton")
    themeBtn.Size = UDim2.new(0, 70, 0, 35)
    themeBtn.Position = UDim2.new(0, 10 + (i-1) * 75, 0, 35)
    themeBtn.BackgroundColor3 = theme.color
    themeBtn.Text = theme.name
    themeBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
    themeBtn.TextSize = 10
    themeBtn.Font = Enum.Font.GothamBold
    themeBtn.ZIndex = 3
    themeBtn.Parent = themeFrame
    
    local themeBtnCorner = Instance.new("UICorner")
    themeBtnCorner.CornerRadius = UDim.new(0, 6)
    themeBtnCorner.Parent = themeBtn
    
    themeButtons[theme.name] = {button = themeBtn, theme = theme}
end

-- Save Settings Button
local saveBtn = Instance.new("TextButton")
saveBtn.Size = UDim2.new(0, 150, 0, 35)
saveBtn.Position = UDim2.new(0.5, -75, 0, 190)
saveBtn.BackgroundColor3 = Color3.fromRGB(34, 197, 94)
saveBtn.Text = "üíæ Save Settings"
saveBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
saveBtn.TextSize = 12
saveBtn.Font = Enum.Font.GothamBold
saveBtn.ZIndex = 3
saveBtn.Parent = settingsContent

local saveBtnCorner = Instance.new("UICorner")
saveBtnCorner.CornerRadius = UDim.new(0, 8)
saveBtnCorner.Parent = saveBtn

-- Functions
local function applyTheme(theme)
    currentTheme = theme.name
    bgGradient.Color = ColorSequence.new{
        ColorSequenceKeypoint.new(0, theme.gradient1),
        ColorSequenceKeypoint.new(1, theme.gradient2)
    }
    
    -- Update active tab color
    if homeContent.Visible then
        homeTab.BackgroundColor3 = theme.color
    elseif scriptContent.Visible then
        scriptTab.BackgroundColor3 = theme.color
    elseif otherContent.Visible then
        otherTab.BackgroundColor3 = theme.color
    elseif settingsContent.Visible then
        settingsTab.BackgroundColor3 = theme.color
    end
end

local function toggleDarkMode()
    darkMode = not darkMode
    
    if darkMode then
        mainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 35)
        darkModeToggle.BackgroundColor3 = Color3.fromRGB(51, 102, 204)
        darkModeToggle.Text = "ON"
        darkModeToggle.TextColor3 = Color3.fromRGB(255, 255, 255)
        darkModeLabel.TextColor3 = Color3.fromRGB(220, 220, 220)
        themeLabel.TextColor3 = Color3.fromRGB(220, 220, 220)
        settingsHeader.TextColor3 = Color3.fromRGB(220, 220, 220)
        speedLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
        jumpLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
        fovLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
        darkModeFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 45)
        themeFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 45)
    else
        mainFrame.BackgroundColor3 = Color3.fromRGB(250, 250, 252)
        darkModeToggle.BackgroundColor3 = Color3.fromRGB(200, 200, 200)
        darkModeToggle.Text = "OFF"
        darkModeToggle.TextColor3 = Color3.fromRGB(51, 51, 51)
        darkModeLabel.TextColor3 = Color3.fromRGB(51, 51, 51)
        themeLabel.TextColor3 = Color3.fromRGB(51, 51, 51)
        settingsHeader.TextColor3 = Color3.fromRGB(51, 51, 51)
        speedLabel.TextColor3 = Color3.fromRGB(76, 76, 76)
        jumpLabel.TextColor3 = Color3.fromRGB(76, 76, 76)
        fovLabel.TextColor3 = Color3.fromRGB(76, 76, 76)
        darkModeFrame.BackgroundColor3 = Color3.fromRGB(240, 240, 240)
        themeFrame.BackgroundColor3 = Color3.fromRGB(240, 240, 240)
    end
end

local function createButton(text, position, parent, callback)
    local btn = Instance.new("TextButton")
    btn.Size = UDim2.new(0, 95, 0, 25)
    btn.Position = position
    btn.BackgroundColor3 = Color3.fromRGB(217, 230, 255)
    btn.Text = text
    btn.TextColor3 = Color3.fromRGB(51, 76, 153)
    btn.TextSize = 10
    btn.Font = Enum.Font.Gotham
    btn.ZIndex = 2
    btn.Parent = parent
    
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 5)
    corner.Parent = btn
    
    btn.MouseButton1Click:Connect(callback)
    return btn
end

-- Speed/Jump Sliders
local speedLabel = Instance.new("TextLabel")
speedLabel.Size = UDim2.new(0, 150, 0, 15)
speedLabel.Position = UDim2.new(0, 10, 0, 10)
speedLabel.BackgroundTransparency = 1
speedLabel.Text = "Speed: 16"
speedLabel.TextColor3 = Color3.fromRGB(76, 76, 76)
speedLabel.TextSize = 10
speedLabel.Font = Enum.Font.Gotham
speedLabel.TextXAlignment = Enum.TextXAlignment.Left
speedLabel.ZIndex = 2
speedLabel.Parent = homeContent

local speedBox = Instance.new("TextBox")
speedBox.Size = UDim2.new(0, 60, 0, 20)
speedBox.Position = UDim2.new(0, 10, 0, 30)
speedBox.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
speedBox.Text = "16"
speedBox.TextColor3 = Color3.fromRGB(0, 0, 0)
speedBox.TextSize = 10
speedBox.Font = Enum.Font.Gotham
speedBox.ZIndex = 2
speedBox.Parent = homeContent

local speedCorner = Instance.new("UICorner")
speedCorner.CornerRadius = UDim.new(0, 3)
speedCorner.Parent = speedBox

local jumpLabel = Instance.new("TextLabel")
jumpLabel.Size = UDim2.new(0, 150, 0, 15)
jumpLabel.Position = UDim2.new(0, 200, 0, 10)
jumpLabel.BackgroundTransparency = 1
jumpLabel.Text = "Jump: 50"
jumpLabel.TextColor3 = Color3.fromRGB(76, 76, 76)
jumpLabel.TextSize = 10
jumpLabel.Font = Enum.Font.Gotham
jumpLabel.TextXAlignment = Enum.TextXAlignment.Left
jumpLabel.ZIndex = 2
jumpLabel.Parent = homeContent

local jumpBox = Instance.new("TextBox")
jumpBox.Size = UDim2.new(0, 60, 0, 20)
jumpBox.Position = UDim2.new(0, 200, 0, 30)
jumpBox.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
jumpBox.Text = "50"
jumpBox.TextColor3 = Color3.fromRGB(0, 0, 0)
jumpBox.TextSize = 10
jumpBox.Font = Enum.Font.Gotham
jumpBox.ZIndex = 2
jumpBox.Parent = homeContent

local jumpCorner = Instance.new("UICorner")
jumpCorner.CornerRadius = UDim.new(0, 3)
jumpCorner.Parent = jumpBox

-- FOV Slider
local fovLabel = Instance.new("TextLabel")
fovLabel.Size = UDim2.new(0, 150, 0, 15)
fovLabel.Position = UDim2.new(0, 10, 0, 210)
fovLabel.BackgroundTransparency = 1
fovLabel.Text = "FOV: 70"
fovLabel.TextColor3 = Color3.fromRGB(76, 76, 76)
fovLabel.TextSize = 10
fovLabel.Font = Enum.Font.Gotham
fovLabel.TextXAlignment = Enum.TextXAlignment.Left
fovLabel.ZIndex = 2
fovLabel.Parent = homeContent

local fovBox = Instance.new("TextBox")
fovBox.Size = UDim2.new(0, 50, 0, 20)
fovBox.Position = UDim2.new(0, 10, 0, 230)
fovBox.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
fovBox.Text = "70"
fovBox.TextColor3 = Color3.fromRGB(0, 0, 0)
fovBox.TextSize = 10
fovBox.Font = Enum.Font.Gotham
fovBox.ZIndex = 2
fovBox.Parent = homeContent

local fovCorner = Instance.new("UICorner")
fovCorner.CornerRadius = UDim.new(0, 3)
fovCorner.Parent = fovBox

local fovApply = createButton("Apply", UDim2.new(0, 70, 0, 230), homeContent, function()
    local fov = tonumber(fovBox.Text) or 70
    if fov < 1 then fov = 1 end
    if fov > 120 then fov = 120 end
    workspace.CurrentCamera.FieldOfView = fov
    fovLabel.Text = "FOV: " .. fov
end)

-- Home Buttons
createButton("üèÉ Speed", UDim2.new(0, 8, 0, 60), homeContent, function()
    local speed = tonumber(speedBox.Text) or 16
    humanoid.WalkSpeed = speed
    speedLabel.Text = "Speed: " .. speed
end)

createButton("ü¶ò Jump", UDim2.new(0, 110, 0, 60), homeContent, function()
    local jump = tonumber(jumpBox.Text) or 50
    humanoid.JumpPower = jump
    jumpLabel.Text = "Jump: " .. jump
end)

createButton("üëª Noclip", UDim2.new(0, 212, 0, 60), homeContent, function()
    noclip = not noclip
end)

createButton("üïäÔ∏è Fly", UDim2.new(0, 8, 0, 95), homeContent, function()
    pcall(function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/GhostPlayer352/Test4/main/Vehicle%20Fly%20Gui"))()
    end)
end)

createButton("‚ôæÔ∏è Inf Jump", UDim2.new(0, 110, 0, 95), homeContent, function()
    infiniteJump = not infiniteJump
    if infiniteJump then
        jumpConnection = UserInputService.JumpRequest:Connect(function()
            if character:FindFirstChild("Humanoid") then
                character.Humanoid:ChangeState(Enum.HumanoidStateType.Jumping)
            end
        end)
    else
        if jumpConnection then jumpConnection:Disconnect() end
    end
end)

createButton("üìç Players", UDim2.new(0, 212, 0, 95), homeContent, function()
    -- Placeholder for player list
end)

createButton("üì∑ Reset Cam", UDim2.new(0, 8, 0, 130), homeContent, function()
    workspace.CurrentCamera.CameraSubject = character.Humanoid
end)

local afkBtn = createButton("‚ö° Anti-AFK", UDim2.new(0, 110, 0, 130), homeContent, function()
    if not antiAFK then
        antiAFK = true
        afkConnection = Players.LocalPlayer.Idled:Connect(function()
            game:GetService("VirtualUser"):CaptureController()
            game:GetService("VirtualUser"):ClickButton2(Vector2.new())
        end)
        afkBtn.Text = "‚úÖ AFK ON"
        afkBtn.BackgroundColor3 = Color3.fromRGB(102, 204, 102)
    end
end)

createButton("üîÑ Reset", UDim2.new(0, 212, 0, 130), homeContent, function()
    humanoid.WalkSpeed = 16
    humanoid.JumpPower = 50
    workspace.CurrentCamera.FieldOfView = 70
    noclip = false
    infiniteJump = false
    esp = false
    fullbright = false
    
    if jumpConnection then jumpConnection:Disconnect() end
    if afkConnection then afkConnection:Disconnect() end
    if espConnection then espConnection:Disconnect() end
    
    afkBtn.Text = "‚ö° Anti-AFK"
    afkBtn.BackgroundColor3 = Color3.fromRGB(217, 230, 255)
    
    speedBox.Text = "16"
    jumpBox.Text = "50"
    fovBox.Text = "70"
    speedLabel.Text = "Speed: 16"
    jumpLabel.Text = "Jump: 50"
    fovLabel.Text = "FOV: 70"
end)

local espBtn = createButton("üëÅÔ∏è ESP", UDim2.new(0, 8, 0, 165), homeContent, function()
    esp = not esp
    if esp then
        espBtn.Text = "‚úÖ ESP ON"
        espBtn.BackgroundColor3 = Color3.fromRGB(102, 204, 102)
    else
        espBtn.Text = "üëÅÔ∏è ESP"
        espBtn.BackgroundColor3 = Color3.fromRGB(217, 230, 255)
    end
end)

local fbBtn = createButton("üí° Fullbright", UDim2.new(0, 110, 0, 165), homeContent, function()
    fullbright = not fullbright
    local lighting = game:GetService("Lighting")
    if fullbright then
        lighting.Brightness = 2
        lighting.ClockTime = 14
        lighting.FogEnd = 100000
        lighting.GlobalShadows = false
        fbBtn.Text = "‚úÖ FB ON"
        fbBtn.BackgroundColor3 = Color3.fromRGB(102, 204, 102)
    else
        lighting.Brightness = 1
        lighting.ClockTime = 12
        lighting.GlobalShadows = true
        fbBtn.Text = "üí° Fullbright"
        fbBtn.BackgroundColor3 = Color3.fromRGB(217, 230, 255)
    end
end)

-- Noclip Loop
RunService.Stepped:Connect(function()
    if noclip and character then
        for _, part in pairs(character:GetChildren()) do
            if part:IsA("BasePart") then
                part.CanCollide = false
            end
        end
    end
end)

-- Tab Switching
local function switchToTab(tabName)
    homeContent.Visible = false
    scriptContent.Visible = false
    otherContent.Visible = false
    settingsContent.Visible = false
    
    homeTab.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    homeTab.TextColor3 = Color3.fromRGB(128, 128, 128)
    scriptTab.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    scriptTab.TextColor3 = Color3.fromRGB(128, 128, 128)
    otherTab.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    otherTab.TextColor3 = Color3.fromRGB(128, 128, 128)
    settingsTab.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    settingsTab.TextColor3 = Color3.fromRGB(128, 128, 128)
    
    local activeColor = Color3.fromRGB(51, 102, 204)
    for _, data in pairs(themeButtons) do
        if data.theme.name == currentTheme then
            activeColor = data.theme.color
            break
        end
    end
    
    if tabName == "Home" then
        homeContent.Visible = true
        homeTab.BackgroundColor3 = activeColor
        homeTab.TextColor3 = Color3.fromRGB(255, 255, 255)
    elseif tabName == "Script" then
        scriptContent.Visible = true
        scriptTab.BackgroundColor3 = activeColor
        scriptTab.TextColor3 = Color3.fromRGB(255, 255, 255)
    elseif tabName == "Other" then
        otherContent.Visible = true
        otherTab.BackgroundColor3 = activeColor
        otherTab.TextColor3 = Color3.fromRGB(255, 255, 255)
    elseif tabName == "Settings" then
        settingsContent.Visible = true
        settingsTab.BackgroundColor3 = activeColor
        settingsTab.TextColor3 = Color3.fromRGB(255, 255, 255)
    end
end

homeTab.MouseButton1Click:Connect(function()
    switchToTab("Home")
end)

scriptTab.MouseButton1Click:Connect(function()
    switchToTab("Script")
end)

otherTab.MouseButton1Click:Connect(function()
    switchToTab("Other")
end)

settingsTab.MouseButton1Click:Connect(function()
    switchToTab("Settings")
end)

-- Close/Toggle
closeBtn.MouseButton1Click:Connect(function()
    mainFrame.Visible = false
    toggleButton.Visible = true
end)

toggleButton.MouseButton1Click:Connect(function()
    mainFrame.Visible = true
    toggleButton.Visible = false
end)

-- Keyboard Shortcut
UserInputService.InputBegan:Connect(function(input, gpe)
    if gpe then return end
    if input.KeyCode == Enum.KeyCode.RightShift then
        mainFrame.Visible = not mainFrame.Visible
        toggleButton.Visible = not mainFrame.Visible
    end
end)

-- Theme Buttons Events
for themeName, data in pairs(themeButtons) do
    data.button.MouseButton1Click:Connect(function()
        applyTheme(data.theme)
        switchToTab(homeContent.Visible and "Home" or scriptContent.Visible and "Script" or otherContent.Visible and "Other" or "Settings")
    end)
end

-- Dark Mode Toggle
darkModeToggle.MouseButton1Click:Connect(function()
    toggleDarkMode()
end)

-- Save Settings
saveBtn.MouseButton1Click:Connect(function()
    saveBtn.Text = "‚úÖ Saved!"
    saveBtn.BackgroundColor3 = Color3.fromRGB(22, 163, 74)
    wait(1.5)
    saveBtn.Text = "üíæ Save Settings"
    saveBtn.BackgroundColor3 = Color3.fromRGB(34, 197, 94)
end)

print("‚ú® Mila UI V4.0 Loaded!")
print("üìå Press Right Shift to toggle")
print("üÜï New: Dark Mode, Themes, Settings Tab!")