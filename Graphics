-- ROBLOX GRAPHICS MASTER V5.0 - STABLE VERSION
-- Ultimate Graphics Enhancement with Fixed Code

local RunService = game:GetService("RunService")
local Lighting = game:GetService("Lighting")
local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local SoundService = game:GetService("SoundService")
local Workspace = game:GetService("Workspace")

local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")
local camera = Workspace.CurrentCamera

-- Settings storage
local settings = {
    autoEnhance = false,
    fpsBoost = true,
    qualityLevel = "Default",
    particleOptimize = true,
    soundOptimize = true,
    uiVisible = true,
    currentTab = "enhance"
}

-- Background processes
local fpsMonitor = nil

-- Create main GUI
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "GraphicsMasterV5_" .. math.random(1000, 9999)
screenGui.Parent = playerGui
screenGui.ResetOnSpawn = false

-- Main Frame
local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(0, 480, 0, 350)
mainFrame.Position = UDim2.new(0.5, -240, 0.5, -175)
mainFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 30)
mainFrame.BorderSizePixel = 0
mainFrame.Parent = screenGui

-- Frame corner
local frameCorner = Instance.new("UICorner")
frameCorner.CornerRadius = UDim.new(0, 20)
frameCorner.Parent = mainFrame

-- Gradient
local frameGradient = Instance.new("UIGradient")
frameGradient.Color = ColorSequence.new({
    ColorSequenceKeypoint.new(0, Color3.fromRGB(35, 35, 50)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(20, 20, 30))
})
frameGradient.Rotation = 135
frameGradient.Parent = mainFrame

-- Header
local headerFrame = Instance.new("Frame")
headerFrame.Size = UDim2.new(1, 0, 0, 65)
headerFrame.BackgroundColor3 = Color3.fromRGB(70, 130, 180)
headerFrame.BorderSizePixel = 0
headerFrame.Parent = mainFrame

local headerCorner = Instance.new("UICorner")
headerCorner.CornerRadius = UDim.new(0, 20)
headerCorner.Parent = headerFrame

local title = Instance.new("TextLabel")
title.Size = UDim2.new(0.7, 0, 1, 0)
title.Position = UDim2.new(0, 15, 0, 0)
title.BackgroundTransparency = 1
title.Text = "üöÄ GRAPHICS MASTER V2.0"
title.TextColor3 = Color3.fromRGB(255, 255, 255)
title.TextScaled = true
title.Font = Enum.Font.GothamBold
title.TextXAlignment = Enum.TextXAlignment.Left
title.Parent = headerFrame

-- Close button
local closeButton = Instance.new("TextButton")
closeButton.Size = UDim2.new(0, 45, 0, 45)
closeButton.Position = UDim2.new(1, -55, 0, 10)
closeButton.BackgroundColor3 = Color3.fromRGB(255, 70, 70)
closeButton.BorderSizePixel = 0
closeButton.Text = "‚ùå"
closeButton.TextColor3 = Color3.fromRGB(255, 255, 255)
closeButton.TextScaled = true
closeButton.Font = Enum.Font.GothamBold
closeButton.Parent = headerFrame

local closeCorner = Instance.new("UICorner")
closeCorner.CornerRadius = UDim.new(0, 22)
closeCorner.Parent = closeButton

-- Tab Frame
local tabFrame = Instance.new("Frame")
tabFrame.Size = UDim2.new(1, -20, 0, 50)
tabFrame.Position = UDim2.new(0, 10, 0, 75)
tabFrame.BackgroundTransparency = 1
tabFrame.Parent = mainFrame

-- Tab buttons
local enhanceTab = Instance.new("TextButton")
enhanceTab.Size = UDim2.new(0.48, 0, 1, 0)
enhanceTab.BackgroundColor3 = Color3.fromRGB(50, 200, 100)
enhanceTab.BorderSizePixel = 0
enhanceTab.Text = "‚ú® TƒÇNG ƒê·ªí H·ªåA"
enhanceTab.TextColor3 = Color3.fromRGB(255, 255, 255)
enhanceTab.TextScaled = true
enhanceTab.Font = Enum.Font.GothamBold
enhanceTab.Parent = tabFrame

local enhanceCorner = Instance.new("UICorner")
enhanceCorner.CornerRadius = UDim.new(0, 15)
enhanceCorner.Parent = enhanceTab

local performanceTab = Instance.new("TextButton")
performanceTab.Size = UDim2.new(0.48, 0, 1, 0)
performanceTab.Position = UDim2.new(0.52, 0, 0, 0)
performanceTab.BackgroundColor3 = Color3.fromRGB(100, 100, 120)
performanceTab.BorderSizePixel = 0
performanceTab.Text = "üöÄ GI·∫¢M ƒê·ªí H·ªåA"
performanceTab.TextColor3 = Color3.fromRGB(200, 200, 200)
performanceTab.TextScaled = true
performanceTab.Font = Enum.Font.GothamBold
performanceTab.Parent = tabFrame

local performanceCorner = Instance.new("UICorner")
performanceCorner.CornerRadius = UDim.new(0, 15)
performanceCorner.Parent = performanceTab

-- Content Frame
local contentFrame = Instance.new("Frame")
contentFrame.Size = UDim2.new(1, -20, 0, 190)
contentFrame.Position = UDim2.new(0, 10, 0, 135)
contentFrame.BackgroundTransparency = 1
contentFrame.Parent = mainFrame

-- Enhance Content
local enhanceContent = Instance.new("ScrollingFrame")
enhanceContent.Size = UDim2.new(1, 0, 1, 0)
enhanceContent.BackgroundTransparency = 1
enhanceContent.BorderSizePixel = 0
enhanceContent.ScrollBarThickness = 6
enhanceContent.Visible = true
enhanceContent.Parent = contentFrame

local enhanceLayout = Instance.new("UIGridLayout")
enhanceLayout.CellSize = UDim2.new(0, 140, 0, 45)
enhanceLayout.CellPadding = UDim2.new(0, 8, 0, 8)
enhanceLayout.SortOrder = Enum.SortOrder.LayoutOrder
enhanceLayout.Parent = enhanceContent

-- Performance Content
local performanceContent = Instance.new("ScrollingFrame")
performanceContent.Size = UDim2.new(1, 0, 1, 0)
performanceContent.BackgroundTransparency = 1
performanceContent.BorderSizePixel = 0
performanceContent.ScrollBarThickness = 6
performanceContent.Visible = false
performanceContent.Parent = contentFrame

local performanceLayout = Instance.new("UIGridLayout")
performanceLayout.CellSize = UDim2.new(0, 140, 0, 45)
performanceLayout.CellPadding = UDim2.new(0, 8, 0, 8)
performanceLayout.SortOrder = Enum.SortOrder.LayoutOrder
performanceLayout.Parent = performanceContent

-- Status Bar
local statusFrame = Instance.new("Frame")
statusFrame.Size = UDim2.new(1, -20, 0, 30)
statusFrame.Position = UDim2.new(0, 10, 1, -40)
statusFrame.BackgroundColor3 = Color3.fromRGB(35, 35, 50)
statusFrame.BorderSizePixel = 0
statusFrame.Parent = mainFrame

local statusCorner = Instance.new("UICorner")
statusCorner.CornerRadius = UDim.new(0, 15)
statusCorner.Parent = statusFrame

local fpsLabel = Instance.new("TextLabel")
fpsLabel.Size = UDim2.new(0.5, 0, 1, 0)
fpsLabel.BackgroundTransparency = 1
fpsLabel.Text = "üìä FPS: --"
fpsLabel.TextColor3 = Color3.fromRGB(0, 255, 0)
fpsLabel.TextScaled = true
fpsLabel.Font = Enum.Font.GothamSemibold
fpsLabel.TextXAlignment = Enum.TextXAlignment.Left
fpsLabel.Parent = statusFrame

local statusLabel = Instance.new("TextLabel")
statusLabel.Size = UDim2.new(0.5, 0, 1, 0)
statusLabel.Position = UDim2.new(0.5, 0, 0, 0)
statusLabel.BackgroundTransparency = 1
statusLabel.Text = "‚ö° Ready"
statusLabel.TextColor3 = Color3.fromRGB(0, 255, 127)
statusLabel.TextScaled = true
statusLabel.Font = Enum.Font.GothamSemibold
statusLabel.TextXAlignment = Enum.TextXAlignment.Right
statusLabel.Parent = statusFrame

-- Dragging
local dragging = false
local dragStart = nil
local startPos = nil

headerFrame.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = true
        dragStart = input.Position
        startPos = mainFrame.Position
    end
end)

headerFrame.InputChanged:Connect(function(input)
    if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
        local delta = input.Position - dragStart
        mainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, 
                                     startPos.Y.Scale, startPos.Y.Offset + delta.Y)
    end
end)

headerFrame.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = false
    end
end)

-- Notification system
local function showNotification(text, color, duration)
    duration = duration or 3
    
    local notification = Instance.new("Frame")
    notification.Size = UDim2.new(0, 350, 0, 60)
    notification.Position = UDim2.new(0.5, -175, 0, -70)
    notification.BackgroundColor3 = color or Color3.fromRGB(0, 150, 0)
    notification.BorderSizePixel = 0
    notification.BackgroundTransparency = 1
    notification.Parent = screenGui
    
    local notifCorner = Instance.new("UICorner")
    notifCorner.CornerRadius = UDim.new(0, 15)
    notifCorner.Parent = notification
    
    local notifText = Instance.new("TextLabel")
    notifText.Size = UDim2.new(1, -10, 1, 0)
    notifText.Position = UDim2.new(0, 5, 0, 0)
    notifText.BackgroundTransparency = 1
    notifText.Text = text
    notifText.TextColor3 = Color3.fromRGB(255, 255, 255)
    notifText.TextScaled = true
    notifText.Font = Enum.Font.GothamSemibold
    notifText.Parent = notification
    
    local slideIn = TweenService:Create(notification,
        TweenInfo.new(0.5, Enum.EasingStyle.Back, Enum.EasingDirection.Out),
        {Position = UDim2.new(0.5, -175, 0, 30), BackgroundTransparency = 0}
    )
    slideIn:Play()
    
    spawn(function()
        wait(duration)
        local slideOut = TweenService:Create(notification,
            TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.In),
            {Position = UDim2.new(0.5, -175, 0, -70), BackgroundTransparency = 1}
        )
        slideOut:Play()
        slideOut.Completed:Connect(function()
            notification:Destroy()
        end)
    end)
end

-- Button creator
local function createButton(text, icon, callback, color, parent, layoutOrder)
    local button = Instance.new("TextButton")
    button.BackgroundColor3 = color or Color3.fromRGB(70, 130, 180)
    button.BorderSizePixel = 0
    button.Text = ""
    button.LayoutOrder = layoutOrder or 0
    button.Parent = parent
    
    local buttonCorner = Instance.new("UICorner")
    buttonCorner.CornerRadius = UDim.new(0, 12)
    buttonCorner.Parent = button
    
    local iconLabel = Instance.new("TextLabel")
    iconLabel.Size = UDim2.new(1, 0, 0.5, 0)
    iconLabel.BackgroundTransparency = 1
    iconLabel.Text = icon
    iconLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    iconLabel.TextScaled = true
    iconLabel.Font = Enum.Font.GothamBold
    iconLabel.Parent = button
    
    local textLabel = Instance.new("TextLabel")
    textLabel.Size = UDim2.new(1, -4, 0.5, 0)
    textLabel.Position = UDim2.new(0, 2, 0.5, 0)
    textLabel.BackgroundTransparency = 1
    textLabel.Text = text
    textLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    textLabel.TextScaled = true
    textLabel.Font = Enum.Font.Gotham
    textLabel.Parent = button
    
    -- Hover effects
    button.MouseEnter:Connect(function()
        local hoverTween = TweenService:Create(button,
            TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
            {Size = UDim2.new(0, 145, 0, 50)}
        )
        hoverTween:Play()
    end)
    
    button.MouseLeave:Connect(function()
        local leaveTween = TweenService:Create(button,
            TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
            {Size = UDim2.new(0, 140, 0, 45)}
        )
        leaveTween:Play()
    end)
    
    button.MouseButton1Click:Connect(function()
        local clickTween = TweenService:Create(button,
            TweenInfo.new(0.1, Enum.EasingStyle.Quad, Enum.EasingDirection.InOut),
            {Size = UDim2.new(0, 135, 0, 40)}
        )
        clickTween:Play()
        
        clickTween.Completed:Connect(function()
            local returnTween = TweenService:Create(button,
                TweenInfo.new(0.1, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
                {Size = UDim2.new(0, 140, 0, 45)}
            )
            returnTween:Play()
        end)
        
        callback()
    end)
    
    return button
end

-- LIGHTING FUNCTIONS

-- RTX Lighting
local function rtxLighting()
    statusLabel.Text = "üîÑ RTX Mode..."
    
    Lighting.Brightness = 2.8
    Lighting.Ambient = Color3.fromRGB(50, 55, 70)
    Lighting.OutdoorAmbient = Color3.fromRGB(120, 130, 160)
    Lighting.Technology = Enum.Technology.Future
    Lighting.GlobalShadows = true
    Lighting.ShadowSoftness = 0.5
    
    -- Clear old effects
    for _, effect in pairs(Lighting:GetChildren()) do
        if effect:IsA("PostEffect") and effect.Name:find("RTX") then
            effect:Destroy()
        end
    end
    
    -- RTX Effects
    local colorCorrection = Instance.new("ColorCorrectionEffect")
    colorCorrection.Name = "RTXColorCorrection"
    colorCorrection.Brightness = 0.05
    colorCorrection.Contrast = 0.6
    colorCorrection.Saturation = 0.8
    colorCorrection.Parent = Lighting
    
    local bloom = Instance.new("BloomEffect")
    bloom.Name = "RTXBloom"
    bloom.Intensity = 1.2
    bloom.Size = 40
    bloom.Threshold = 0.6
    bloom.Parent = Lighting
    
    settings.qualityLevel = "RTX"
    statusLabel.Text = "‚ú® RTX Active"
    statusLabel.TextColor3 = Color3.fromRGB(0, 255, 200)
    showNotification("‚ú® RTX Lighting Activated!", Color3.fromRGB(0, 255, 200))
end

-- Ultra Lighting
local function ultraLighting()
    statusLabel.Text = "üîÑ Ultra Mode..."
    
    Lighting.Brightness = 3
    Lighting.Ambient = Color3.fromRGB(80, 80, 100)
    Lighting.OutdoorAmbient = Color3.fromRGB(150, 150, 180)
    Lighting.Technology = Enum.Technology.Future
    Lighting.GlobalShadows = true
    Lighting.ShadowSoftness = 0.3
    
    for _, effect in pairs(Lighting:GetChildren()) do
        if effect:IsA("PostEffect") and effect.Name:find("Ultra") then
            effect:Destroy()
        end
    end
    
    local colorCorrection = Instance.new("ColorCorrectionEffect")
    colorCorrection.Name = "UltraColorCorrection"
    colorCorrection.Brightness = 0.15
    colorCorrection.Contrast = 0.3
    colorCorrection.Saturation = 0.4
    colorCorrection.Parent = Lighting
    
    local bloom = Instance.new("BloomEffect")
    bloom.Name = "UltraBloom"
    bloom.Intensity = 0.8
    bloom.Size = 30
    bloom.Threshold = 0.8
    bloom.Parent = Lighting
    
    settings.qualityLevel = "Ultra"
    statusLabel.Text = "üåü Ultra Active"
    statusLabel.TextColor3 = Color3.fromRGB(255, 215, 0)
    showNotification("üåü Ultra Lighting Applied!", Color3.fromRGB(255, 215, 0))
end

-- Gaming Mode
local function gamingMode()
    statusLabel.Text = "üîÑ Gaming Mode..."
    
    Lighting.Brightness = 2.2
    Lighting.Ambient = Color3.fromRGB(70, 70, 85)
    Lighting.OutdoorAmbient = Color3.fromRGB(120, 120, 140)
    Lighting.Technology = Enum.Technology.Future
    Lighting.GlobalShadows = true
    Lighting.ShadowSoftness = 0.1
    
    for _, effect in pairs(Lighting:GetChildren()) do
        if effect:IsA("PostEffect") then
            effect:Destroy()
        end
    end
    
    local colorCorrection = Instance.new("ColorCorrectionEffect")
    colorCorrection.Name = "GamingCorrection"
    colorCorrection.Brightness = 0.08
    colorCorrection.Contrast = 0.3
    colorCorrection.Saturation = 0.6
    colorCorrection.Parent = Lighting
    
    settings.qualityLevel = "Gaming"
    statusLabel.Text = "üéÆ Gaming"
    statusLabel.TextColor3 = Color3.fromRGB(255, 100, 255)
    showNotification("üéÆ Gaming Mode Optimized!", Color3.fromRGB(255, 100, 255))
end

-- Enhanced Lighting
local function enhancedLighting()
    statusLabel.Text = "üîÑ Enhanced..."
    
    Lighting.Brightness = 2.5
    Lighting.Ambient = Color3.fromRGB(60, 60, 80)
    Lighting.OutdoorAmbient = Color3.fromRGB(130, 130, 160)
    Lighting.Technology = Enum.Technology.Future
    Lighting.GlobalShadows = true
    Lighting.ShadowSoftness = 0.2
    
    for _, effect in pairs(Lighting:GetChildren()) do
        if effect:IsA("PostEffect") then
            effect:Destroy()
        end
    end
    
    local colorCorrection = Instance.new("ColorCorrectionEffect")
    colorCorrection.Name = "EnhancedCorrection"
    colorCorrection.Brightness = 0.1
    colorCorrection.Contrast = 0.25
    colorCorrection.Saturation = 0.35
    colorCorrection.Parent = Lighting
    
    local bloom = Instance.new("BloomEffect")
    bloom.Name = "EnhancedBloom"
    bloom.Intensity = 0.6
    bloom.Size = 28
    bloom.Threshold = 0.9
    bloom.Parent = Lighting
    
    settings.qualityLevel = "Enhanced"
    statusLabel.Text = "‚úÖ Enhanced"
    statusLabel.TextColor3 = Color3.fromRGB(0, 255, 127)
    showNotification("‚úÖ Enhanced Lighting Applied!", Color3.fromRGB(0, 255, 127))
end

-- Cinematic Mode
local function cinematicMode()
    statusLabel.Text = "üîÑ Cinematic..."
    
    Lighting.Brightness = 1.8
    Lighting.Ambient = Color3.fromRGB(40, 45, 60)
    Lighting.OutdoorAmbient = Color3.fromRGB(120, 140, 170)
    Lighting.Technology = Enum.Technology.Future
    Lighting.GlobalShadows = true
    
    for _, effect in pairs(Lighting:GetChildren()) do
        if effect:IsA("PostEffect") then
            effect:Destroy()
        end
    end
    
    local colorCorrection = Instance.new("ColorCorrectionEffect")
    colorCorrection.Name = "CinematicCorrection"
    colorCorrection.Brightness = -0.05
    colorCorrection.Contrast = 0.5
    colorCorrection.Saturation = 0.3
    colorCorrection.TintColor = Color3.fromRGB(220, 230, 255)
    colorCorrection.Parent = Lighting
    
    settings.qualityLevel = "Cinematic"
    statusLabel.Text = "üé¨ Cinematic"
    statusLabel.TextColor3 = Color3.fromRGB(138, 43, 226)
    showNotification("üé¨ Cinematic Mode Enabled!", Color3.fromRGB(138, 43, 226))
end

-- Fullbright Mode
local function fullbrightMode()
    statusLabel.Text = "üîÑ Fullbright..."
    
    Lighting.Brightness = 10
    Lighting.Ambient = Color3.new(1, 1, 1)
    Lighting.OutdoorAmbient = Color3.new(1, 1, 1)
    Lighting.GlobalShadows = false
    
    for _, effect in pairs(Lighting:GetChildren()) do
        if effect:IsA("PostEffect") then
            effect:Destroy()
        end
    end
    
    settings.qualityLevel = "Fullbright"
    statusLabel.Text = "üí° Fullbright"
    statusLabel.TextColor3 = Color3.fromRGB(255, 255, 0)
    showNotification("üí° Fullbright Mode Activated!", Color3.fromRGB(255, 255, 0))
end

-- PERFORMANCE FUNCTIONS

-- Smart Performance
local function smartPerformance()
    statusLabel.Text = "üîÑ Smart Mode..."
    
    local currentFPS = fps or 60
    
    if currentFPS < 20 then
        -- Extreme optimization
        Lighting.Technology = Enum.Technology.Compatibility
        Lighting.GlobalShadows = false
        
        for _, obj in pairs(Workspace:GetDescendants()) do
            if obj:IsA("ParticleEmitter") then
                obj.Rate = math.min(obj.Rate, 5)
            elseif obj:IsA("MeshPart") then
                obj.RenderFidelity = Enum.RenderFidelity.Performance
            end
        end
        
    elseif currentFPS < 40 then
        -- Moderate optimization
        Lighting.Technology = Enum.Technology.ShadowMap
        Lighting.GlobalShadows = false
        
        for _, obj in pairs(Workspace:GetDescendants()) do
            if obj:IsA("ParticleEmitter") then
                obj.Rate = math.min(obj.Rate, 20)
            end
        end
    end
    
    settings.qualityLevel = "Smart"
    statusLabel.Text = "üß† Smart"
    statusLabel.TextColor3 = Color3.fromRGB(255, 200, 0)
    showNotification("üß† Smart Performance Applied!", Color3.fromRGB(255, 200, 0))
end

-- Extreme Performance
local function extremePerformance()
    statusLabel.Text = "üîÑ Extreme..."
    
    for _, effect in pairs(Lighting:GetChildren()) do
        if effect:IsA("PostEffect") then
            effect:Destroy()
        end
    end
    
    Lighting.Technology = Enum.Technology.Compatibility
    Lighting.GlobalShadows = false
    Lighting.Brightness = 1
    
    for _, obj in pairs(Workspace:GetDescendants()) do
        if obj:IsA("BasePart") then
            obj.Material = Enum.Material.SmoothPlastic
            obj.CastShadow = false
        elseif obj:IsA("ParticleEmitter") then
            obj.Rate = math.min(obj.Rate, 10)
        end
    end
    
    settings.qualityLevel = "Extreme"
    statusLabel.Text = "üöÄ Extreme"
    statusLabel.TextColor3 = Color3.fromRGB(255, 69, 0)
    showNotification("üöÄ Extreme Performance!", Color3.fromRGB(255, 69, 0))
end

-- Anti-Lag
local function antiLag()
    statusLabel.Text = "üîÑ Anti-Lag..."
    
    local optimized = 0
    
    for _, obj in pairs(Workspace:GetDescendants()) do
        if obj:IsA("ParticleEmitter") and obj.Rate > 50 then
            obj.Rate = 20
            optimized = optimized + 1
        elseif obj:IsA("Sound") and obj.Volume > 0.6 and not obj.Playing then
            obj.Volume = 0.3
            optimized = optimized + 1
        elseif obj:IsA("BasePart") then
            obj.CastShadow = false
        end
    end
    
    Lighting.GlobalShadows = false
    
    settings.qualityLevel = "Anti-Lag"
    statusLabel.Text = "üõ°Ô∏è Anti-Lag"
    statusLabel.TextColor3 = Color3.fromRGB(0, 191, 255)
    showNotification("üõ°Ô∏è Anti-Lag: " .. optimized .. " items fixed!", Color3.fromRGB(0, 191, 255))
end

-- Reset All
local function resetAll()
    statusLabel.Text = "üîÑ Resetting..."
    
    Lighting.Brightness = 1
    Lighting.Ambient = Color3.fromRGB(70, 70, 70)
    Lighting.OutdoorAmbient = Color3.fromRGB(70, 70, 70)
    Lighting.Technology = Enum.Technology.Compatibility
    Lighting.GlobalShadows = false
    
    for _, effect in pairs(Lighting:GetChildren()) do
        if effect:IsA("PostEffect") then
            effect:Destroy()
        end
    end
    
    settings.qualityLevel = "Default"
    statusLabel.Text = "‚ö° Ready"
    statusLabel.TextColor3 = Color3.fromRGB(0, 255, 127)
    showNotification("üîÑ All Settings Reset!", Color3.fromRGB(255, 165, 0))
end

-- Tab switching
local function switchToTab(tabName)
    settings.currentTab = tabName
    
    if tabName == "enhance" then
        enhanceTab.BackgroundColor3 = Color3.fromRGB(50, 200, 100)
        enhanceTab.TextColor3 = Color3.fromRGB(255, 255, 255)
        performanceTab.BackgroundColor3 = Color3.fromRGB(100, 100, 120)
        performanceTab.TextColor3 = Color3.fromRGB(200, 200, 200)
        
        enhanceContent.Visible = true
        performanceContent.Visible = false
    else
        performanceTab.BackgroundColor3 = Color3.fromRGB(255, 100, 50)
        performanceTab.TextColor3 = Color3.fromRGB(255, 255, 255)
        enhanceTab.BackgroundColor3 = Color3.fromRGB(100, 100, 120)
        enhanceTab.TextColor3 = Color3.fromRGB(200, 200, 200)
        
        performanceContent.Visible = true
        enhanceContent.Visible = false
    end
end

-- Tab click events
enhanceTab.MouseButton1Click:Connect(function()
    if settings.currentTab ~= "enhance" then
        switchToTab("enhance")
    end
end)

performanceTab.MouseButton1Click:Connect(function()
    if settings.currentTab ~= "performance" then
        switchToTab("performance")
    end
end)

-- Create buttons

-- Enhancement buttons (Tab 1)
createButton("RTX Mode", "‚ú®", rtxLighting, Color3.fromRGB(0, 255, 200), enhanceContent, 1)
createButton("Ultra", "üåü", ultraLighting, Color3.fromRGB(255, 215, 0), enhanceContent, 2)
createButton("Gaming", "üéÆ", gamingMode, Color3.fromRGB(255, 100, 255), enhanceContent, 3)
createButton("Enhanced", "üåà", enhancedLighting, Color3.fromRGB(70, 130, 180), enhanceContent, 4)
createButton("Cinematic", "üé¨", cinematicMode, Color3.fromRGB(138, 43, 226), enhanceContent, 5)
createButton("Fullbright", "üí°", fullbrightMode, Color3.fromRGB(255, 255, 0), enhanceContent, 6)

-- Performance buttons (Tab 2)
createButton("Smart Mode", "üß†", smartPerformance, Color3.fromRGB(255, 200, 0), performanceContent, 1)
createButton("Extreme", "üöÄ", extremePerformance, Color3.fromRGB(255, 69, 0), performanceContent, 2)
createButton("Anti-Lag", "üõ°Ô∏è", antiLag, Color3.fromRGB(0, 191, 255), performanceContent, 3)
createButton("Reset All", "üîÑ", resetAll, Color3.fromRGB(255, 165, 0), performanceContent, 4)

-- Update canvas sizes
enhanceContent.CanvasSize = UDim2.new(0, 0, 0, math.ceil(6/3) * 53)
performanceContent.CanvasSize = UDim2.new(0, 0, 0, math.ceil(4/3) * 53)

-- FPS Monitor
local fps = 0
local frameTime = tick()
local frameCount = 0

fpsMonitor = RunService.Heartbeat:Connect(function()
    frameCount = frameCount + 1
    if frameCount >= 30 then
        fps = math.floor(30 / (tick() - frameTime))
        frameTime = tick()
        frameCount = 0
        
        fpsLabel.Text = "üìä FPS: " .. fps
        
        if fps >= 50 then
            fpsLabel.TextColor3 = Color3.fromRGB(0, 255, 0)
        elseif fps >= 35 then
            fpsLabel.TextColor3 = Color3.fromRGB(255, 255, 0)
        elseif fps >= 20 then
            fpsLabel.TextColor3 = Color3.fromRGB(255, 165, 0)
        else
            fpsLabel.TextColor3 = Color3.fromRGB(255, 0, 0)
        end
    end
end)

-- Close/Hide UI
closeButton.MouseButton1Click:Connect(function()
    settings.uiVisible = not settings.uiVisible
    
    if not settings.uiVisible then
        local hideTween = TweenService:Create(mainFrame,
            TweenInfo.new(0.5, Enum.EasingStyle.Back, Enum.EasingDirection.In),
            {Position = UDim2.new(0.5, -240, 0, -400)}
        )
        hideTween:Play()
        
        hideTween.Completed:Connect(function()
            mainFrame.Visible = false
        end)
        
        -- Create floating button
        local floatingButton = Instance.new("TextButton")
        floatingButton.Size = UDim2.new(0, 50, 0, 50)
        floatingButton.Position = UDim2.new(1, -60, 0, 10)
        floatingButton.BackgroundColor3 = Color3.fromRGB(70, 130, 180)
        floatingButton.BorderSizePixel = 0
        floatingButton.Text = "üöÄ"
        floatingButton.TextColor3 = Color3.fromRGB(255, 255, 255)
        floatingButton.TextScaled = true
        floatingButton.Font = Enum.Font.GothamBold
        floatingButton.BackgroundTransparency = 0.2
        floatingButton.Parent = screenGui
        
        local floatingCorner = Instance.new("UICorner")
        floatingCorner.CornerRadius = UDim.new(0, 25)
        floatingCorner.Parent = floatingButton
        
        -- Floating animation
        local floatTween = TweenService:Create(floatingButton,
            TweenInfo.new(2, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut, -1, true),
            {BackgroundTransparency = 0.5}
        )
        floatTween:Play()
        
        -- Click to restore
        floatingButton.MouseButton1Click:Connect(function()
            settings.uiVisible = true
            mainFrame.Visible = true
            
            local showTween = TweenService:Create(mainFrame,
                TweenInfo.new(0.6, Enum.EasingStyle.Back, Enum.EasingDirection.Out),
                {Position = UDim2.new(0.5, -240, 0.5, -175)}
            )
            showTween:Play()
            
            floatTween:Cancel()
            floatingButton:Destroy()
            showNotification("üëÅÔ∏è UI Restored!", Color3.fromRGB(0, 255, 127))
        end)
        
        showNotification("üîç UI Hidden - All functions active!", Color3.fromRGB(255, 165, 0))
    end
end)

-- Background optimization
spawn(function()
    while true do
        wait(30)
        if settings.fpsBoost and fps < 25 then
            for _, obj in pairs(Workspace:GetDescendants()) do
                if obj:IsA("ParticleEmitter") and obj.Rate > 40 then
                    obj.Rate = 15
                elseif obj:IsA("Sound") and obj.Volume > 0.5 and not obj.Playing then
                    obj.Volume = 0.2
                end
            end
        end
    end
end)

-- Hotkeys
UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if gameProcessed then return end
    
    if input.KeyCode == Enum.KeyCode.F1 then
        rtxLighting()
    elseif input.KeyCode == Enum.KeyCode.F2 then
        smartPerformance()
    elseif input.KeyCode == Enum.KeyCode.F3 then
        antiLag()
    elseif input.KeyCode == Enum.KeyCode.F4 then
        closeButton.MouseButton1Click:Fire()
    elseif input.KeyCode == Enum.KeyCode.F5 then
        resetAll()
    elseif input.KeyCode == Enum.KeyCode.F6 then
        fullbrightMode()
    elseif input.KeyCode == Enum.KeyCode.F7 then
        gamingMode()
    elseif input.KeyCode == Enum.KeyCode.F8 then
        switchToTab(settings.currentTab == "enhance" and "performance" or "enhance")
    end
end)

-- Welcome messages
spawn(function()
    wait(1)
    showNotification("üöÄ Graphics Master V5.0 Ready!", Color3.fromRGB(70, 130, 180), 4)
    wait(2)
    showNotification("‚ö° Stable and optimized version!", Color3.fromRGB(255, 215, 0), 3)
    wait(1)
    showNotification("‚å®Ô∏è Hotkeys F1-F8 | ‚úï to hide UI", Color3.fromRGB(0, 191, 255), 3)
end)

-- Cleanup
game.Players.PlayerRemoving:Connect(function(plr)
    if plr == player then
        if fpsMonitor then fpsMonitor:Disconnect() end
    end
end)

-- Console logs
print("üöÄ Graphics Master V5.0 - Stable Fixed Version")
print("‚ú® Tab 1: TƒÇNG ƒê·ªí H·ªåA - RTX, Ultra, Gaming, Enhanced, Cinematic, Fullbright")
print("üöÄ Tab 2: GI·∫¢M ƒê·ªí H·ªåA - Smart Mode, Extreme, Anti-Lag, Reset")
print("üé® Modern UI with smooth animations and effects")
print("‚å®Ô∏è  Hotkeys: F1=RTX, F2=Smart, F3=Anti-Lag, F4=Toggle UI, F5=Reset, F6=Fullbright, F7=Gaming, F8=Switch Tab")
print("üîÑ Background optimization continues when UI is hidden")
print("üìä Real-time FPS monitoring with color indicators")
print("üéØ Click ‚úï to hide UI, click floating üöÄ to restore")
print("üë§ No auto-enhancement - users have full control")
print("üß† Smart Mode: Automatically detects FPS and applies appropriate optimization")
print("‚úÖ Fixed all errors and optimized for stability")
print("üåü Made by Graphics Enhancement Team - V5.0 Stable Edition")