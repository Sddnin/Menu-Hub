-- ğŸµ MUSIC PLAYER 3.0 - ULTIMATE EDITION - FULL CODE
-- Táº¡o bá»Ÿi Claude | Version 3.0 Complete
-- âœ¨ Features: Visualizer, Playlist, Themes, Stats, 5 Tabs

local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")

local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

-- Music Library
local musicLibrary = {
    {name = "Raining ğŸŒ®", id = "142376088", category = "Chill"},
    {name = "Fart", id = "4809574295", category = "Meme"},
    {name = "Get out!", id = "18900008907", category = "Hype"},
    {name = "Dare", id = "139188421510869", category = "Dance"},
    {name = "The World", id = "1836847994", category = "Epic"},
    {name = "Turks and CaiCos", id = "105615035181825", category = "Chill"},
    {name = "My Way", id = "1837856940", category = "Classic"},
    {name = "Clash Royale", id = "109699229726518", category = "Game"},
    {name = "Holiday", id = "1836006159", category = "Chill"},
    {name = "Metamorphosis Remix", id = "15689451063", category = "EDM"},
    {name = "ğŸ«¡", id = "1845922899", category = "Meme"},
    {name = "BÃ¬nh Bucu", id = "7000891754", category = "Viá»‡t Nam"},
    {name = "Anh báº¡n Ã !", id = "7108789306", category = "Viá»‡t Nam"},
    {name = "Cáº£i LÆ°Æ¡ng", id = "1843400900", category = "Viá»‡t Nam"},
    {name = "ÄÃ¡m ma", id = "1845920681", category = "Viá»‡t Nam"},
}

-- User Data
local userData = {
    history = {},
    playlist = {},
    volume = 5,
    repeatMode = "off",
    shuffleMode = false,
    totalPlays = 0,
    visualizerEnabled = true
}

-- Colors
local colors = {
    primary = Color3.fromRGB(25, 25, 35),
    secondary = Color3.fromRGB(40, 40, 50),
    accent = Color3.fromRGB(138, 43, 226),
    danger = Color3.fromRGB(220, 38, 38),
    success = Color3.fromRGB(34, 197, 94),
    warning = Color3.fromRGB(251, 191, 36),
    text = Color3.fromRGB(255, 255, 255),
    textSecondary = Color3.fromRGB(156, 163, 175)
}

-- Variables
local currentSound = nil
local currentPlaying = nil
local filteredMusic = {}
local currentTab = 1
local isMinimized = false
local visualizerConnection = nil

-- Create GUI
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "MusicPlayerV3"
screenGui.ResetOnSpawn = false
screenGui.Parent = playerGui

-- Main Frame
local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(0, 500, 0, 450)
mainFrame.Position = UDim2.new(0.5, -250, 0.5, -225)
mainFrame.BackgroundColor3 = colors.primary
mainFrame.BorderSizePixel = 0
mainFrame.Parent = screenGui

local mainCorner = Instance.new("UICorner")
mainCorner.CornerRadius = UDim.new(0, 15)
mainCorner.Parent = mainFrame

-- Header
local headerFrame = Instance.new("Frame")
headerFrame.Size = UDim2.new(1, 0, 0, 60)
headerFrame.BackgroundTransparency = 1
headerFrame.Parent = mainFrame

local titleLabel = Instance.new("TextLabel")
titleLabel.Size = UDim2.new(0, 250, 1, 0)
titleLabel.Position = UDim2.new(0, 20, 0, 0)
titleLabel.BackgroundTransparency = 1
titleLabel.Text = "ğŸµ MUSIC PLAYER 3.0"
titleLabel.TextColor3 = colors.text
titleLabel.TextSize = 20
titleLabel.Font = Enum.Font.GothamBold
titleLabel.TextXAlignment = Enum.TextXAlignment.Left
titleLabel.Parent = headerFrame

local statsLabel = Instance.new("TextLabel")
statsLabel.Size = UDim2.new(0, 150, 0, 20)
statsLabel.Position = UDim2.new(1, -280, 0, 15)
statsLabel.BackgroundTransparency = 1
statsLabel.Text = "ğŸ“Š Plays: 0 | Songs: 15"
statsLabel.TextColor3 = colors.textSecondary
statsLabel.TextSize = 11
statsLabel.Font = Enum.Font.Gotham
statsLabel.TextXAlignment = Enum.TextXAlignment.Right
statsLabel.Parent = headerFrame

local minimizeBtn = Instance.new("TextButton")
minimizeBtn.Size = UDim2.new(0, 30, 0, 30)
minimizeBtn.Position = UDim2.new(1, -80, 0, 15)
minimizeBtn.BackgroundColor3 = colors.secondary
minimizeBtn.BorderSizePixel = 0
minimizeBtn.Text = "â–¢"
minimizeBtn.TextColor3 = colors.text
minimizeBtn.TextSize = 14
minimizeBtn.Font = Enum.Font.GothamBold
minimizeBtn.Parent = headerFrame

local minimizeBtnCorner = Instance.new("UICorner")
minimizeBtnCorner.CornerRadius = UDim.new(0, 8)
minimizeBtnCorner.Parent = minimizeBtn

local closeBtn = Instance.new("TextButton")
closeBtn.Size = UDim2.new(0, 30, 0, 30)
closeBtn.Position = UDim2.new(1, -40, 0, 15)
closeBtn.BackgroundColor3 = colors.danger
closeBtn.BorderSizePixel = 0
closeBtn.Text = "âœ•"
closeBtn.TextColor3 = colors.text
closeBtn.TextSize = 14
closeBtn.Font = Enum.Font.GothamBold
closeBtn.Parent = headerFrame

local closeBtnCorner = Instance.new("UICorner")
closeBtnCorner.CornerRadius = UDim.new(0, 8)
closeBtnCorner.Parent = closeBtn

-- Now Playing
local nowPlayingFrame = Instance.new("Frame")
nowPlayingFrame.Size = UDim2.new(1, -30, 0, 90)
nowPlayingFrame.Position = UDim2.new(0, 15, 0, 65)
nowPlayingFrame.BackgroundColor3 = colors.secondary
nowPlayingFrame.BorderSizePixel = 0
nowPlayingFrame.Parent = mainFrame

local nowPlayingCorner = Instance.new("UICorner")
nowPlayingCorner.CornerRadius = UDim.new(0, 12)
nowPlayingCorner.Parent = nowPlayingFrame

-- Visualizer
local visualizerFrame = Instance.new("Frame")
visualizerFrame.Size = UDim2.new(0, 60, 0, 60)
visualizerFrame.Position = UDim2.new(0, 15, 0, 15)
visualizerFrame.BackgroundColor3 = colors.primary
visualizerFrame.BorderSizePixel = 0
visualizerFrame.Parent = nowPlayingFrame

local visualizerCorner = Instance.new("UICorner")
visualizerCorner.CornerRadius = UDim.new(0, 10)
visualizerCorner.Parent = visualizerFrame

local visualizerBars = {}
for i = 1, 5 do
    local bar = Instance.new("Frame")
    bar.Size = UDim2.new(0, 6, 0, 5)
    bar.Position = UDim2.new(0, 7 + (i-1) * 10, 1, -10)
    bar.BackgroundColor3 = colors.accent
    bar.BorderSizePixel = 0
    bar.Parent = visualizerFrame
    
    local barCorner = Instance.new("UICorner")
    barCorner.CornerRadius = UDim.new(1, 0)
    barCorner.Parent = bar
    
    visualizerBars[i] = bar
end

-- Now Playing Info
local nowPlayingLabel = Instance.new("TextLabel")
nowPlayingLabel.Size = UDim2.new(1, -320, 0, 25)
nowPlayingLabel.Position = UDim2.new(0, 85, 0, 12)
nowPlayingLabel.BackgroundTransparency = 1
nowPlayingLabel.Text = "No music playing"
nowPlayingLabel.TextColor3 = colors.text
nowPlayingLabel.TextSize = 15
nowPlayingLabel.Font = Enum.Font.GothamBold
nowPlayingLabel.TextXAlignment = Enum.TextXAlignment.Left
nowPlayingLabel.TextTruncate = Enum.TextTruncate.AtEnd
nowPlayingLabel.Parent = nowPlayingFrame

local categoryLabel = Instance.new("TextLabel")
categoryLabel.Size = UDim2.new(1, -320, 0, 18)
categoryLabel.Position = UDim2.new(0, 85, 0, 35)
categoryLabel.BackgroundTransparency = 1
categoryLabel.Text = "Category: None"
categoryLabel.TextColor3 = colors.textSecondary
categoryLabel.TextSize = 11
categoryLabel.Font = Enum.Font.Gotham
categoryLabel.TextXAlignment = Enum.TextXAlignment.Left
categoryLabel.Parent = nowPlayingFrame

local statusLabel = Instance.new("TextLabel")
statusLabel.Size = UDim2.new(1, -320, 0, 16)
statusLabel.Position = UDim2.new(0, 85, 0, 50)
statusLabel.BackgroundTransparency = 1
statusLabel.Text = "Volume: 5 | Ready"
statusLabel.TextColor3 = colors.textSecondary
statusLabel.TextSize = 10
statusLabel.Font = Enum.Font.Gotham
statusLabel.TextXAlignment = Enum.TextXAlignment.Left
statusLabel.Parent = nowPlayingFrame

-- Controls
local controlsFrame = Instance.new("Frame")
controlsFrame.Size = UDim2.new(0, 200, 0, 70)
controlsFrame.Position = UDim2.new(1, -210, 0, 10)
controlsFrame.BackgroundTransparency = 1
controlsFrame.Parent = nowPlayingFrame

local volumeLabel = Instance.new("TextLabel")
volumeLabel.Size = UDim2.new(0, 50, 0, 18)
volumeLabel.Position = UDim2.new(0, 5, 0, 2)
volumeLabel.BackgroundTransparency = 1
volumeLabel.Text = "ğŸ”Š Vol:"
volumeLabel.TextColor3 = colors.text
volumeLabel.TextSize = 11
volumeLabel.Font = Enum.Font.GothamBold
volumeLabel.TextXAlignment = Enum.TextXAlignment.Left
volumeLabel.Parent = controlsFrame

local volumeSlider = Instance.new("TextBox")
volumeSlider.Size = UDim2.new(0, 50, 0, 22)
volumeSlider.Position = UDim2.new(0, 55, 0, 0)
volumeSlider.BackgroundColor3 = colors.primary
volumeSlider.BorderSizePixel = 1
volumeSlider.BorderColor3 = colors.accent
volumeSlider.Text = "5"
volumeSlider.TextColor3 = colors.text
volumeSlider.TextSize = 12
volumeSlider.Font = Enum.Font.GothamBold
volumeSlider.Parent = controlsFrame

local volumeCorner = Instance.new("UICorner")
volumeCorner.CornerRadius = UDim.new(0, 6)
volumeCorner.Parent = volumeSlider

local repeatBtn = Instance.new("TextButton")
repeatBtn.Size = UDim2.new(0, 35, 0, 25)
repeatBtn.Position = UDim2.new(0, 5, 0, 28)
repeatBtn.BackgroundColor3 = colors.primary
repeatBtn.BorderSizePixel = 0
repeatBtn.Text = "ğŸ”„"
repeatBtn.TextColor3 = colors.textSecondary
repeatBtn.TextSize = 14
repeatBtn.Font = Enum.Font.Gotham
repeatBtn.Parent = controlsFrame

local repeatCorner = Instance.new("UICorner")
repeatCorner.CornerRadius = UDim.new(0, 6)
repeatCorner.Parent = repeatBtn

local shuffleBtn = Instance.new("TextButton")
shuffleBtn.Size = UDim2.new(0, 35, 0, 25)
shuffleBtn.Position = UDim2.new(0, 45, 0, 28)
shuffleBtn.BackgroundColor3 = colors.primary
shuffleBtn.BorderSizePixel = 0
shuffleBtn.Text = "ğŸ”€"
shuffleBtn.TextColor3 = colors.textSecondary
shuffleBtn.TextSize = 14
shuffleBtn.Font = Enum.Font.Gotham
shuffleBtn.Parent = controlsFrame

local shuffleCorner = Instance.new("UICorner")
shuffleCorner.CornerRadius = UDim.new(0, 6)
shuffleCorner.Parent = shuffleBtn

local visualizerBtn = Instance.new("TextButton")
visualizerBtn.Size = UDim2.new(0, 35, 0, 25)
visualizerBtn.Position = UDim2.new(0, 85, 0, 28)
visualizerBtn.BackgroundColor3 = colors.primary
visualizerBtn.BorderSizePixel = 0
visualizerBtn.Text = "ğŸ“Š"
visualizerBtn.TextColor3 = colors.accent
visualizerBtn.TextSize = 14
visualizerBtn.Font = Enum.Font.Gotham
visualizerBtn.Parent = controlsFrame

local visualizerBtnCorner = Instance.new("UICorner")
visualizerBtnCorner.CornerRadius = UDim.new(0, 6)
visualizerBtnCorner.Parent = visualizerBtn

-- Tabs
local tabFrame = Instance.new("Frame")
tabFrame.Size = UDim2.new(1, -30, 0, 45)
tabFrame.Position = UDim2.new(0, 15, 0, 165)
tabFrame.BackgroundTransparency = 1
tabFrame.Parent = mainFrame

local tabButtons = {}
local tabNames = {"ğŸ†” Manual", "ğŸ“‹ Library", "ğŸ² Random", "ğŸ“œ History", "â­ Playlist"}

for i, tabName in ipairs(tabNames) do
    local tabBtn = Instance.new("TextButton")
    tabBtn.Size = UDim2.new(0.2, -4, 1, 0)
    tabBtn.Position = UDim2.new((i-1) * 0.2, (i-1) * 4, 0, 0)
    tabBtn.BackgroundColor3 = i == 1 and colors.accent or colors.secondary
    tabBtn.BorderSizePixel = 0
    tabBtn.Text = tabName
    tabBtn.TextColor3 = colors.text
    tabBtn.TextSize = 11
    tabBtn.Font = Enum.Font.GothamBold
    tabBtn.TextScaled = true
    tabBtn.Parent = tabFrame
    
    local tabCorner = Instance.new("UICorner")
    tabCorner.CornerRadius = UDim.new(0, 8)
    tabCorner.Parent = tabBtn
    
    tabButtons[i] = tabBtn
end

-- Content Area
local contentFrame = Instance.new("Frame")
contentFrame.Size = UDim2.new(1, -30, 1, -220)
contentFrame.Position = UDim2.new(0, 15, 0, 215)
contentFrame.BackgroundTransparency = 1
contentFrame.Parent = mainFrame

-- TAB 1: Manual
local manualTab = Instance.new("Frame")
manualTab.Size = UDim2.new(1, 0, 1, 0)
manualTab.BackgroundTransparency = 1
manualTab.Visible = true
manualTab.Parent = contentFrame

local manualTitle = Instance.new("TextLabel")
manualTitle.Size = UDim2.new(1, 0, 0, 25)
manualTitle.Position = UDim2.new(0, 5, 0, 5)
manualTitle.BackgroundTransparency = 1
manualTitle.Text = "ğŸµ Manual Input - Enter Music ID"
manualTitle.TextColor3 = colors.text
manualTitle.TextSize = 14
manualTitle.Font = Enum.Font.GothamBold
manualTitle.TextXAlignment = Enum.TextXAlignment.Left
manualTitle.Parent = manualTab

local idInput = Instance.new("TextBox")
idInput.Size = UDim2.new(1, -10, 0, 45)
idInput.Position = UDim2.new(0, 5, 0, 35)
idInput.BackgroundColor3 = colors.secondary
idInput.BorderSizePixel = 1
idInput.BorderColor3 = colors.accent
idInput.PlaceholderText = "Enter Roblox Music ID..."
idInput.Text = ""
idInput.TextColor3 = colors.text
idInput.TextSize = 14
idInput.Font = Enum.Font.Gotham
idInput.Parent = manualTab

local idInputCorner = Instance.new("UICorner")
idInputCorner.CornerRadius = UDim.new(0, 10)
idInputCorner.Parent = idInput

local manualControlFrame = Instance.new("Frame")
manualControlFrame.Size = UDim2.new(1, -10, 0, 45)
manualControlFrame.Position = UDim2.new(0, 5, 0, 90)
manualControlFrame.BackgroundTransparency = 1
manualControlFrame.Parent = manualTab

local playManualBtn = Instance.new("TextButton")
playManualBtn.Size = UDim2.new(0.32, 0, 1, 0)
playManualBtn.Position = UDim2.new(0, 0, 0, 0)
playManualBtn.BackgroundColor3 = colors.success
playManualBtn.BorderSizePixel = 0
playManualBtn.Text = "â–¶ï¸ PLAY"
playManualBtn.TextColor3 = colors.text
playManualBtn.TextSize = 14
playManualBtn.Font = Enum.Font.GothamBold
playManualBtn.Parent = manualControlFrame

local playManualCorner = Instance.new("UICorner")
playManualCorner.CornerRadius = UDim.new(0, 8)
playManualCorner.Parent = playManualBtn

local stopBtn = Instance.new("TextButton")
stopBtn.Size = UDim2.new(0.32, 0, 1, 0)
stopBtn.Position = UDim2.new(0.34, 0, 0, 0)
stopBtn.BackgroundColor3 = colors.danger
stopBtn.BorderSizePixel = 0
stopBtn.Text = "â¹ï¸ STOP"
stopBtn.TextColor3 = colors.text
stopBtn.TextSize = 14
stopBtn.Font = Enum.Font.GothamBold
stopBtn.Parent = manualControlFrame

local stopBtnCorner = Instance.new("UICorner")
stopBtnCorner.CornerRadius = UDim.new(0, 8)
stopBtnCorner.Parent = stopBtn

local addPlaylistBtn = Instance.new("TextButton")
addPlaylistBtn.Size = UDim2.new(0.32, 0, 1, 0)
addPlaylistBtn.Position = UDim2.new(0.68, 0, 0, 0)
addPlaylistBtn.BackgroundColor3 = colors.warning
addPlaylistBtn.BorderSizePixel = 0
addPlaylistBtn.Text = "â­ ADD"
addPlaylistBtn.TextColor3 = colors.text
addPlaylistBtn.TextSize = 14
addPlaylistBtn.Font = Enum.Font.GothamBold
addPlaylistBtn.Parent = manualControlFrame

local addPlaylistCorner = Instance.new("UICorner")
addPlaylistCorner.CornerRadius = UDim.new(0, 8)
addPlaylistCorner.Parent = addPlaylistBtn

-- TAB 2: Library
local libraryTab = Instance.new("Frame")
libraryTab.Size = UDim2.new(1, 0, 1, 0)
libraryTab.BackgroundTransparency = 1
libraryTab.Visible = false
libraryTab.Parent = contentFrame

local searchBox = Instance.new("TextBox")
searchBox.Size = UDim2.new(1, -10, 0, 35)
searchBox.Position = UDim2.new(0, 5, 0, 5)
searchBox.BackgroundColor3 = colors.secondary
searchBox.BorderSizePixel = 1
searchBox.BorderColor3 = colors.accent
searchBox.PlaceholderText = "ğŸ” Search songs..."
searchBox.Text = ""
searchBox.TextColor3 = colors.text
searchBox.TextSize = 12
searchBox.Font = Enum.Font.Gotham
searchBox.Parent = libraryTab

local searchCorner = Instance.new("UICorner")
searchCorner.CornerRadius = UDim.new(0, 8)
searchCorner.Parent = searchBox

local libraryScroll = Instance.new("ScrollingFrame")
libraryScroll.Size = UDim2.new(1, -10, 1, -45)
libraryScroll.Position = UDim2.new(0, 5, 0, 45)
libraryScroll.BackgroundColor3 = colors.secondary
libraryScroll.BorderSizePixel = 0
libraryScroll.ScrollBarThickness = 6
libraryScroll.ScrollBarImageColor3 = colors.accent
libraryScroll.Parent = libraryTab

local libraryScrollCorner = Instance.new("UICorner")
libraryScrollCorner.CornerRadius = UDim.new(0, 8)
libraryScrollCorner.Parent = libraryScroll

local libraryLayout = Instance.new("UIListLayout")
libraryLayout.SortOrder = Enum.SortOrder.LayoutOrder
libraryLayout.Padding = UDim.new(0, 3)
libraryLayout.Parent = libraryScroll

-- TAB 3: Random
local randomTab = Instance.new("Frame")
randomTab.Size = UDim2.new(1, 0, 1, 0)
randomTab.BackgroundTransparency = 1
randomTab.Visible = false
randomTab.Parent = contentFrame

local randomBoxFrame = Instance.new("Frame")
randomBoxFrame.Size = UDim2.new(1, -20, 0, 110)
randomBoxFrame.Position = UDim2.new(0, 10, 0, 10)
randomBoxFrame.BackgroundColor3 = colors.secondary
randomBoxFrame.BorderSizePixel = 2
randomBoxFrame.BorderColor3 = colors.accent
randomBoxFrame.Parent = randomTab

local randomBoxCorner = Instance.new("UICorner")
randomBoxCorner.CornerRadius = UDim2.new(0, 12)
randomBoxCorner.Parent = randomBoxFrame

local mysteryIcon = Instance.new("TextLabel")
mysteryIcon.Size = UDim2.new(0, 70, 0, 70)
mysteryIcon.Position = UDim2.new(0, 20, 0, 20)
mysteryIcon.BackgroundTransparency = 1
mysteryIcon.Text = "ğŸ"
mysteryIcon.TextColor3 = colors.accent
mysteryIcon.TextSize = 45
mysteryIcon.Font = Enum.Font.GothamBold
mysteryIcon.Parent = randomBoxFrame

local randomTitle = Instance.new("TextLabel")
randomTitle.Size = UDim2.new(1, -110, 0, 28)
randomTitle.Position = UDim2.new(0, 100, 0, 15)
randomTitle.BackgroundTransparency = 1
randomTitle.Text = "ğŸ² MYSTERY MUSIC BOX"
randomTitle.TextColor3 = colors.text
randomTitle.TextSize = 16
randomTitle.Font = Enum.Font.GothamBold
randomTitle.TextXAlignment = Enum.TextXAlignment.Left
randomTitle.Parent = randomBoxFrame

local randomDesc = Instance.new("TextLabel")
randomDesc.Size = UDim2.new(1, -110, 0, 40)
randomDesc.Position = UDim2.new(0, 100, 0, 43)
randomDesc.BackgroundTransparency = 1
randomDesc.Text = "Open mystery box to discover\na random song and play instantly!"
randomDesc.TextColor3 = colors.textSecondary
randomDesc.TextSize = 11
randomDesc.Font = Enum.Font.Gotham
randomDesc.TextXAlignment = Enum.TextXAlignment.Left
randomDesc.TextWrapped = true
randomDesc.Parent = randomBoxFrame

local openBoxBtn = Instance.new("TextButton")
openBoxBtn.Size = UDim2.new(1, -40, 0, 50)
openBoxBtn.Position = UDim2.new(0, 20, 0, 130)
openBoxBtn.BackgroundColor3 = colors.accent
openBoxBtn.BorderSizePixel = 0
openBoxBtn.Text = "ğŸ OPEN MYSTERY BOX ğŸ"
openBoxBtn.TextColor3 = colors.text
openBoxBtn.TextSize = 16
openBoxBtn.Font = Enum.Font.GothamBold
openBoxBtn.Parent = randomTab

local openBoxCorner = Instance.new("UICorner")
openBoxCorner.CornerRadius = UDim.new(0, 10)
openBoxCorner.Parent = openBoxBtn

-- TAB 4: History
local historyTab = Instance.new("Frame")
historyTab.Size = UDim2.new(1, 0, 1, 0)
historyTab.BackgroundTransparency = 1
historyTab.Visible = false
historyTab.Parent = contentFrame

local historyScroll = Instance.new("ScrollingFrame")
historyScroll.Size = UDim2.new(1, -10, 1, -10)
historyScroll.Position = UDim2.new(0, 5, 0, 5)
historyScroll.BackgroundColor3 = colors.secondary
historyScroll.BorderSizePixel = 0
historyScroll.ScrollBarThickness = 6
historyScroll.ScrollBarImageColor3 = colors.accent
historyScroll.Parent = historyTab

local historyScrollCorner = Instance.new("UICorner")
historyScrollCorner.CornerRadius = UDim.new(0, 8)
historyScrollCorner.Parent = historyScroll

local historyLayout = Instance.new("UIListLayout")
historyLayout.SortOrder = Enum.SortOrder.LayoutOrder
historyLayout.Padding = UDim.new(0, 3)
historyLayout.Parent = historyScroll

-- TAB 5: Playlist
local playlistTab = Instance.new("Frame")
playlistTab.Size = UDim2.new(1, 0, 1, 0)
playlistTab.BackgroundTransparency = 1
playlistTab.Visible = false
playlistTab.Parent = contentFrame

local playlistScroll = Instance.new("ScrollingFrame")
playlistScroll.Size = UDim2.new(1, -10, 1, -50)
playlistScroll.Position = UDim2.new(0, 5, 0, 5)
playlistScroll.BackgroundColor3 = colors.secondary
playlistScroll.BorderSizePixel = 0
playlistScroll.ScrollBarThickness = 6
playlistScroll.ScrollBarImageColor3 = colors.accent
playlistScroll.Parent = playlistTab

local playlistScrollCorner = Instance.new("UICorner")
playlistScrollCorner.CornerRadius = UDim.new(0, 8)
playlistScrollCorner.Parent = playlistScroll

local playlistLayout = Instance.new("UIListLayout")
playlistLayout.SortOrder = Enum.SortOrder.LayoutOrder
playlistLayout.Padding = UDim.new(0, 3)
playlistLayout.Parent = playlistScroll

local playlistControlFrame = Instance.new("Frame")
playlistControlFrame.Size = UDim2.new(1, -10, 0, 40)
playlistControlFrame.Position = UDim2.new(0, 5, 1, -45)
playlistControlFrame.BackgroundTransparency = 1
playlistControlFrame.Parent = playlistTab

local playAllBtn = Instance.new("TextButton")
playAllBtn.Size = UDim2.new(0.48, 0, 1, 0)
playAllBtn.Position = UDim2.new(0, 0, 0, 0)
playAllBtn.BackgroundColor3 = colors.success
playAllBtn.BorderSizePixel = 0
playAllBtn.Text = "â–¶ï¸ PLAY ALL"
playAllBtn.TextColor3 = colors.text
playAllBtn.TextSize = 14
playAllBtn.Font = Enum.Font.GothamBold
playAllBtn.Parent = playlistControlFrame

local playAllCorner = Instance.new("UICorner")
playAllCorner.CornerRadius = UDim.new(0, 8)
playAllCorner.Parent = playAllBtn

local clearPlaylistBtn = Instance.new("TextButton")
clearPlaylistBtn.Size = UDim2.new(0.48, 0, 1, 0)
clearPlaylistBtn.Position = UDim2.new(0.52, 0, 0, 0)
clearPlaylistBtn.BackgroundColor3 = colors.danger
clearPlaylistBtn.BorderSizePixel = 0
clearPlaylistBtn.Text = "ğŸ—‘ï¸ CLEAR ALL"
clearPlaylistBtn.TextColor3 = colors.text
clearPlaylistBtn.TextSize = 14
clearPlaylistBtn.Font = Enum.Font.GothamBold
clearPlaylistBtn.Parent = playlistControlFrame

local clearPlaylistCorner = Instance.new("UICorner")
clearPlaylistCorner.CornerRadius = UDim.new(0, 8)
clearPlaylistCorner.Parent = clearPlaylistBtn

-- Minimized Frame
local minimizedFrame = Instance.new("Frame")
minimizedFrame.Size = UDim2.new(0, 200, 0, 45)
minimizedFrame.Position = UDim2.new(0.5, -100, 0, 20)
minimizedFrame.BackgroundColor3 = colors.primary
minimizedFrame.BorderSizePixel = 0
minimizedFrame.Visible = false
minimizedFrame.Parent = screenGui

local minimizedCorner = Instance.new("UICorner")
minimizedCorner.CornerRadius = UDim.new(0, 10)
minimizedCorner.Parent = minimizedFrame

local restoreBtn = Instance.new("TextButton")
restoreBtn.Size = UDim2.new(1, -40, 1, 0)
restoreBtn.BackgroundTransparency = 1
restoreBtn.Text = "ğŸµ Music Player 3.0"
restoreBtn.TextColor3 = colors.text
restoreBtn.TextSize = 13
restoreBtn.Font = Enum.Font.GothamBold
restoreBtn.Parent = minimizedFrame

local minCloseBtn = Instance.new("TextButton")
minCloseBtn.Size = UDim2.new(0, 35, 0, 35)
minCloseBtn.Position = UDim2.new(1, -37, 0, 5)
minCloseBtn.BackgroundColor3 = colors.danger
minCloseBtn.BorderSizePixel = 0
minCloseBtn.Text = "âœ•"
minCloseBtn.TextColor3 = colors.text
minCloseBtn.TextSize = 14
minCloseBtn.Font = Enum.Font.GothamBold
minCloseBtn.Parent = minimizedFrame

local minCloseBtnCorner = Instance.new("UICorner")
minCloseBtnCorner.CornerRadius = UDim.new(0, 8)
minCloseBtnCorner.Parent = minCloseBtn

-- FUNCTIONS
local function showNotification(text, color, icon)
    spawn(function()
        local notif = Instance.new("Frame")
        notif.Size = UDim2.new(0, 300, 0, 55)
        notif.Position = UDim2.new(1, 0, 0, 100)
        notif.BackgroundColor3 = color or colors.accent
        notif.BorderSizePixel = 0
        notif.Parent = screenGui
        
        local notifCorner = Instance.new("UICorner")
        notifCorner.CornerRadius = UDim.new(0, 10)
        notifCorner.Parent = notif
        
        local iconLabel = Instance.new("TextLabel")
        iconLabel.Size = UDim2.new(0, 45, 1, 0)
        iconLabel.BackgroundTransparency = 1
        iconLabel.Text = icon or "â„¹ï¸"
        iconLabel.TextColor3 = colors.text
        iconLabel.TextSize = 20
        iconLabel.Font = Enum.Font.GothamBold
        iconLabel.Parent = notif
        
        local textLabel = Instance.new("TextLabel")
        textLabel.Size = UDim2.new(1, -50, 1, 0)
        textLabel.Position = UDim2.new(0, 50, 0, 0)
        textLabel.BackgroundTransparency = 1
        textLabel.Text = text
        textLabel.TextColor3 = colors.text
        textLabel.TextSize = 13
        textLabel.Font = Enum.Font.Gotham
        textLabel.TextXAlignment = Enum.TextXAlignment.Left
        textLabel.TextWrapped = true
        textLabel.Parent = notif
        
        TweenService:Create(notif, TweenInfo.new(0.4, Enum.EasingStyle.Back), {Position = UDim2.new(1, -310, 0, 100)}):Play()
        wait(3)
        local hideTween = TweenService:Create(notif, TweenInfo.new(0.4), {Position = UDim2.new(1, 0, 0, 100)})
        hideTween:Play()
        hideTween.Completed:Connect(function() notif:Destroy() end)
    end)
end

local function updateStats()
    statsLabel.Text = "ğŸ“Š Plays: " .. userData.totalPlays .. " | Songs: " .. #musicLibrary
end

local function createSound(musicId)
    if currentSound then
        pcall(function() currentSound:Stop() currentSound:Destroy() end)
        currentSound = nil
        wait(0.1)
    end
    
    local success, sound = pcall(function()
        local newSound = Instance.new("Sound")
        newSound.SoundId = "rbxassetid://" .. tostring(musicId)
        newSound.Volume = userData.volume
        newSound.Looped = userData.repeatMode == "one"
        newSound.Parent = workspace
        return newSound
    end)
    
    return success and sound or nil
end

local function startVisualizer()
    if visualizerConnection then visualizerConnection:Disconnect() end
    
    if userData.visualizerEnabled and currentSound then
        visualizerConnection = RunService.RenderStepped:Connect(function()
            if currentSound and currentSound.IsPlaying then
                for i, bar in ipairs(visualizerBars) do
                    local height = math.random(10, 50)
                    TweenService:Create(bar, TweenInfo.new(0.1), {Size = UDim2.new(0, 6, 0, height)}):Play()
                end
            else
                for i, bar in ipairs(visualizerBars) do
                    TweenService:Create(bar, TweenInfo.new(0.2), {Size = UDim2.new(0, 6, 0, 5)}):Play()
                end
            end
        end)
    end
end

local function stopVisualizer()
    if visualizerConnection then
        visualizerConnection:Disconnect()
        visualizerConnection = nil
    end
    for i, bar in ipairs(visualizerBars) do
        TweenService:Create(bar, TweenInfo.new(0.3), {Size = UDim2.new(0, 6, 0, 5)}):Play()
    end
end

local function addToHistory(musicData)
    for i, item in ipairs(userData.history) do
        if item.id == musicData.id then
            table.remove(userData.history, i)
            break
        end
    end
    
    table.insert(userData.history, 1, {
        name = musicData.name,
        id = musicData.id,
        category = musicData.category or "Unknown"
    })
    
    if #userData.history > 20 then table.remove(userData.history, 21) end
    updateHistoryTab()
end

local function addToPlaylist(musicData)
    for _, item in ipairs(userData.playlist) do
        if item.id == musicData.id then
            showNotification("Already in playlist!", colors.danger, "â­")
            return
        end
    end
    
    table.insert(userData.playlist, musicData)
    showNotification("Added: " .. musicData.name, colors.success, "â­")
    updatePlaylistTab()
end

local function playMusic(musicData)
    currentSound = createSound(musicData.id)
    
    if not currentSound then
        showNotification("Error! Invalid ID.", colors.danger, "âš ï¸")
        return
    end
    
    local success = pcall(function() currentSound:Play() end)
    
    if not success then
        showNotification("Error playing music!", colors.danger, "âš ï¸")
        return
    end
    
    currentPlaying = musicData
    userData.totalPlays = userData.totalPlays + 1
    
    nowPlayingLabel.Text = musicData.name
    categoryLabel.Text = "Category: " .. (musicData.category or "Unknown")
    statusLabel.Text = "Playing - Vol: " .. userData.volume
    
    addToHistory(musicData)
    updateStats()
    startVisualizer()
    
    showNotification("ğŸµ " .. musicData.name, colors.success, "ğŸµ")
    
    if currentSound then
        currentSound.Ended:Connect(function()
            if userData.repeatMode == "all" then
                local sourceList = userData.shuffleMode and userData.playlist or filteredMusic
                if #sourceList > 0 then
                    local currentIndex = 1
                    for i, item in ipairs(sourceList) do
                        if item.id == musicData.id then currentIndex = i break end
                    end
                    local nextIndex = currentIndex + 1
                    if nextIndex > #sourceList then nextIndex = 1 end
                    if sourceList[nextIndex] then playMusic(sourceList[nextIndex]) else stopMusic() end
                else stopMusic() end
            elseif userData.repeatMode == "one" then
                playMusic(musicData)
            else
                stopMusic()
            end
        end)
    end
end

local function stopMusic()
    if currentSound then
        pcall(function() currentSound:Stop() currentSound:Destroy() end)
        currentSound = nil
    end
    
    stopVisualizer()
    currentPlaying = nil
    nowPlayingLabel.Text = "No music playing"
    categoryLabel.Text = "Category: None"
    statusLabel.Text = "Vol: " .. userData.volume .. " | Ready"
    showNotification("Stopped", colors.danger, "â¹ï¸")
end

local function updateVolume(newVolume)
    newVolume = math.clamp(newVolume, 0, 10)
    userData.volume = newVolume
    volumeSlider.Text = tostring(newVolume)
    
    if currentSound then currentSound.Volume = newVolume end
    
    statusLabel.Text = currentPlaying and ("Playing - Vol: " .. newVolume) or ("Vol: " .. newVolume .. " | Ready")
    
    volumeLabel.Text = (newVolume == 0 and "ğŸ”‡" or (newVolume <= 3 and "ğŸ”‰" or "ğŸ”Š")) .. " Vol:"
    showNotification("Volume: " .. newVolume .. "/10", colors.accent, volumeLabel.Text:sub(1, 4))
end

local function cycleRepeatMode()
    if userData.repeatMode == "off" then
        userData.repeatMode = "one"
        repeatBtn.Text = "ğŸ”‚"
        repeatBtn.TextColor3 = colors.accent
        showNotification("Repeat: One", colors.accent, "ğŸ”‚")
    elseif userData.repeatMode == "one" then
        userData.repeatMode = "all"
        repeatBtn.Text = "ğŸ”"
        repeatBtn.TextColor3 = colors.accent
        showNotification("Repeat: All", colors.accent, "ğŸ”")
    else
        userData.repeatMode = "off"
        repeatBtn.Text = "ğŸ”„"
        repeatBtn.TextColor3 = colors.textSecondary
        showNotification("Repeat: Off", colors.textSecondary, "ğŸ”„")
    end
    
    if currentSound then currentSound.Looped = userData.repeatMode == "one" end
end

local function toggleShuffle()
    userData.shuffleMode = not userData.shuffleMode
    shuffleBtn.TextColor3 = userData.shuffleMode and colors.accent or colors.textSecondary
    showNotification("Shuffle: " .. (userData.shuffleMode and "ON" or "OFF"), colors.accent, "ğŸ”€")
end

local function toggleVisualizer()
    userData.visualizerEnabled = not userData.visualizerEnabled
    visualizerBtn.TextColor3 = userData.visualizerEnabled and colors.accent or colors.textSecondary
    
    if userData.visualizerEnabled then
        startVisualizer()
        showNotification("Visualizer: ON", colors.accent, "ğŸ“Š")
    else
        stopVisualizer()
        showNotification("Visualizer: OFF", colors.textSecondary, "ğŸ“Š")
    end
end

local function openRandomBox()
    mysteryIcon.Text = "ğŸ"
    openBoxBtn.Text = "ğŸ OPENING... ğŸ"
    openBoxBtn.BackgroundColor3 = colors.textSecondary
    
    spawn(function()
        for i = 1, 6 do
            wait(0.15)
            mysteryIcon.Text = i % 2 == 0 and "ğŸ“¦" or "ğŸ"
            mysteryIcon.Rotation = i % 2 == 0 and 15 or -15
        end
        
        mysteryIcon.Rotation = 0
        mysteryIcon.Text = "âœ¨"
        
        local randomSong = musicLibrary[math.random(1, #musicLibrary)]
        wait(0.5)
        playMusic(randomSong)
        
        spawn(function()
            local celebrations = {"ğŸ‰", "âœ¨", "ğŸŠ", "ğŸŒŸ", "ğŸ’«", "ğŸ†"}
            for i = 1, 12 do
                mysteryIcon.Text = celebrations[math.random(1, #celebrations)]
                wait(0.25)
            end
            mysteryIcon.Text = "ğŸ"
        end)
        
        wait(1.5)
        openBoxBtn.Text = "ğŸ OPEN MYSTERY BOX ğŸ"
        openBoxBtn.BackgroundColor3 = colors.accent
    end)
end

local function createMusicItem(musicData, parent, showRemove)
    local itemFrame = Instance.new("Frame")
    itemFrame.Size = UDim2.new(1, -12, 0, 55)
    itemFrame.BackgroundColor3 = colors.primary
    itemFrame.BorderSizePixel = 0
    itemFrame.Parent = parent
    
    local itemCorner = Instance.new("UICorner")
    itemCorner.CornerRadius = UDim.new(0, 8)
    itemCorner.Parent = itemFrame
    
    local nameLabel = Instance.new("TextLabel")
    nameLabel.Size = UDim2.new(1, showRemove and -90 or -50, 0, 22)
    nameLabel.Position = UDim2.new(0, 10, 0, 5)
    nameLabel.BackgroundTransparency = 1
    nameLabel.Text = musicData.name
    nameLabel.TextColor3 = colors.text
    nameLabel.TextSize = 13
    nameLabel.Font = Enum.Font.GothamBold
    nameLabel.TextXAlignment = Enum.TextXAlignment.Left
    nameLabel.TextTruncate = Enum.TextTruncate.AtEnd
    nameLabel.Parent = itemFrame
    
    local categoryLabel2 = Instance.new("TextLabel")
    categoryLabel2.Size = UDim2.new(1, showRemove and -90 or -50, 0, 14)
    categoryLabel2.Position = UDim2.new(0, 10, 0, 25)
    categoryLabel2.BackgroundTransparency = 1
    categoryLabel2.Text = "ğŸ“ " .. (musicData.category or "Unknown")
    categoryLabel2.TextColor3 = colors.textSecondary
    categoryLabel2.TextSize = 10
    categoryLabel2.Font = Enum.Font.Gotham
    categoryLabel2.TextXAlignment = Enum.TextXAlignment.Left
    categoryLabel2.Parent = itemFrame
    
    local idLabel = Instance.new("TextLabel")
    idLabel.Size = UDim2.new(1, showRemove and -90 or -50, 0, 12)
    idLabel.Position = UDim2.new(0, 10, 0, 38)
    idLabel.BackgroundTransparency = 1
    idLabel.Text = "ID: " .. musicData.id
    idLabel.TextColor3 = colors.textSecondary
    idLabel.TextSize = 9
    idLabel.Font = Enum.Font.Gotham
    idLabel.TextXAlignment = Enum.TextXAlignment.Left
    idLabel.TextTruncate = Enum.TextTruncate.AtEnd
    idLabel.Parent = itemFrame
    
    local playBtn = Instance.new("TextButton")
    playBtn.Size = UDim2.new(0, 38, 0, 38)
    playBtn.Position = UDim2.new(1, showRemove and -82 or -43, 0, 8)
    playBtn.BackgroundColor3 = colors.success
    playBtn.BorderSizePixel = 0
    playBtn.Text = "â–¶ï¸"
    playBtn.TextColor3 = colors.text
    playBtn.TextSize = 16
    playBtn.Font = Enum.Font.GothamBold
    playBtn.Parent = itemFrame
    
    local playBtnCorner = Instance.new("UICorner")
    playBtnCorner.CornerRadius = UDim.new(0, 8)
    playBtnCorner.Parent = playBtn
    
    playBtn.MouseButton1Click:Connect(function() playMusic(musicData) end)
    
    if showRemove then
        local removeBtn = Instance.new("TextButton")
        removeBtn.Size = UDim2.new(0, 38, 0, 38)
        removeBtn.Position = UDim2.new(1, -43, 0, 8)
        removeBtn.BackgroundColor3 = colors.danger
        removeBtn.BorderSizePixel = 0
        removeBtn.Text = "ğŸ—‘ï¸"
        removeBtn.TextColor3 = colors.text
        removeBtn.TextSize = 14
        removeBtn.Font = Enum.Font.GothamBold
        removeBtn.Parent = itemFrame
        
        local removeBtnCorner = Instance.new("UICorner")
        removeBtnCorner.CornerRadius = UDim.new(0, 8)
        removeBtnCorner.Parent = removeBtn
        
        removeBtn.MouseButton1Click:Connect(function()
            for i, item in ipairs(userData.playlist) do
                if item.id == musicData.id then
                    table.remove(userData.playlist, i)
                    break
                end
            end
            itemFrame:Destroy()
            updatePlaylistTab()
            showNotification("Removed", colors.danger, "ğŸ—‘ï¸")
        end)
    end
    
    local originalColor = itemFrame.BackgroundColor3
    itemFrame.MouseEnter:Connect(function()
        TweenService:Create(itemFrame, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(
            math.min(255, originalColor.R * 255 * 1.4),
            math.min(255, originalColor.G * 255 * 1.4),
            math.min(255, originalColor.B * 255 * 1.4)
        )}):Play()
    end)
    
    itemFrame.MouseLeave:Connect(function()
        TweenService:Create(itemFrame, TweenInfo.new(0.2), {BackgroundColor3 = originalColor}):Play()
    end)
    
    return itemFrame
end

function updateLibraryTab()
    for _, child in pairs(libraryScroll:GetChildren()) do
        if child:IsA("Frame") then child:Destroy() end
    end
    
    for _, musicData in ipairs(filteredMusic) do
        createMusicItem(musicData, libraryScroll, false)
    end
    
    libraryScroll.CanvasSize = UDim2.new(0, 0, 0, #filteredMusic * 58)
end

function updateHistoryTab()
    for _, child in pairs(historyScroll:GetChildren()) do
        if child:IsA("Frame") then child:Destroy() end
    end
    
    if #userData.history == 0 then
        local emptyLabel = Instance.new("TextLabel")
        emptyLabel.Size = UDim2.new(1, 0, 0, 100)
        emptyLabel.BackgroundTransparency = 1
        emptyLabel.Text = "ğŸ“œ\n\nNo History\n\nPlay music to see here"
        emptyLabel.TextColor3 = colors.textSecondary
        emptyLabel.TextSize = 14
        emptyLabel.Font = Enum.Font.Gotham
        emptyLabel.Parent = historyScroll
    else
        for _, musicData in ipairs(userData.history) do
            createMusicItem(musicData, historyScroll, false)
        end
    end
    
    historyScroll.CanvasSize = UDim2.new(0, 0, 0, math.max(#userData.history * 58, 100))
end

function updatePlaylistTab()
    for _, child in pairs(playlistScroll:GetChildren()) do
        if child:IsA("Frame") then child:Destroy() end
    end
    
    if #userData.playlist == 0 then
        local emptyLabel = Instance.new("TextLabel")
        emptyLabel.Size = UDim2.new(1, 0, 0, 100)
        emptyLabel.BackgroundTransparency = 1
        emptyLabel.Text = "â­\n\nPlaylist Empty\n\nAdd songs!"
        emptyLabel.TextColor3 = colors.textSecondary
        emptyLabel.TextSize = 14
        emptyLabel.Font = Enum.Font.Gotham
        emptyLabel.Parent = playlistScroll
    else
        for _, musicData in ipairs(userData.playlist) do
            createMusicItem(musicData, playlistScroll, true)
        end
    end
    
    playlistScroll.CanvasSize = UDim2.new(0, 0, 0, math.max(#userData.playlist * 58, 100))
end

local function filterMusic(searchText)
    filteredMusic = {}
    searchText = searchText:lower()
    
    if searchText == "" then
        filteredMusic = musicLibrary
    else
        for _, music in ipairs(musicLibrary) do
            if music.name:lower():find(searchText) or music.id:find(searchText) or (music.category and music.category:lower():find(searchText)) then
                table.insert(filteredMusic, music)
            end
        end
    end
    
    updateLibraryTab()
end

local function switchTab(tabIndex)
    currentTab = tabIndex
    
    for i, button in ipairs(tabButtons) do
        button.BackgroundColor3 = i == tabIndex and colors.accent or colors.secondary
    end
    
    manualTab.Visible = tabIndex == 1
    libraryTab.Visible = tabIndex == 2
    randomTab.Visible = tabIndex == 3
    historyTab.Visible = tabIndex == 4
    playlistTab.Visible = tabIndex == 5
    
    if tabIndex == 4 then updateHistoryTab()
    elseif tabIndex == 5 then updatePlaylistTab() end
end

local function toggleMinimize()
    isMinimized = not isMinimized
    
    if isMinimized then
        local tween = TweenService:Create(mainFrame, TweenInfo.new(0.4, Enum.EasingStyle.Back), {Size = UDim2.new(0, 0, 0, 0)})
        tween:Play()
        tween.Completed:Connect(function()
            mainFrame.Visible = false
            minimizedFrame.Visible = true
        end)
    else
        mainFrame.Visible = true
        minimizedFrame.Visible = false
        TweenService:Create(mainFrame, TweenInfo.new(0.4, Enum.EasingStyle.Back), {Size = UDim2.new(0, 500, 0, 450)}):Play()
    end
end

local function closePlayer()
    if currentSound then
        pcall(function() currentSound:Stop() currentSound:Destroy() end)
    end
    stopVisualizer()
    screenGui:Destroy()
end

-- Initialize
filteredMusic = musicLibrary
updateLibraryTab()
updateHistoryTab()
updatePlaylistTab()
updateVolume(userData.volume)
updateStats()

-- Events
for i, button in ipairs(tabButtons) do
    button.MouseButton1Click:Connect(function() switchTab(i) end)
end

playManualBtn.MouseButton1Click:Connect(function()
    local id = idInput.Text:gsub("%s+", "")
    if id ~= "" then
        playMusic({name = "Custom: " .. id, id = id, category = "Manual"})
    else
        showNotification("Enter ID!", colors.danger, "âš ï¸")
    end
end)

stopBtn.MouseButton1Click:Connect(stopMusic)

addPlaylistBtn.MouseButton1Click:Connect(function()
    local id = idInput.Text:gsub("%s+", "")
    if id ~= "" then
        addToPlaylist({name = "Custom: " .. id, id = id, category = "Manual"})
    else
        showNotification("Enter ID!", colors.danger, "âš ï¸")
    end
end)

idInput.FocusLost:Connect(function(enterPressed)
    if enterPressed then
        local id = idInput.Text:gsub("%s+", "")
        if id ~= "" then playMusic({name = "Custom: " .. id, id = id, category = "Manual"}) end
    end
end)

openBoxBtn.MouseButton1Click:Connect(openRandomBox)
searchBox.Changed:Connect(function() filterMusic(searchBox.Text) end)

volumeSlider.FocusLost:Connect(function()
    local volume = tonumber(volumeSlider.Text)
    if volume then updateVolume(volume)
    else volumeSlider.Text = tostring(userData.volume) showNotification("Volume 0-10!", colors.danger, "âš ï¸") end
end)

volumeSlider.Changed:Connect(function()
    if volumeSlider.Text == "+" then updateVolume(userData.volume + 1)
    elseif volumeSlider.Text == "-" then updateVolume(userData.volume - 1) end
end)

repeatBtn.MouseButton1Click:Connect(cycleRepeatMode)
shuffleBtn.MouseButton1Click:Connect(toggleShuffle)
visualizerBtn.MouseButton1Click:Connect(toggleVisualizer)
minimizeBtn.MouseButton1Click:Connect(toggleMinimize)
restoreBtn.MouseButton1Click:Connect(toggleMinimize)
closeBtn.MouseButton1Click:Connect(closePlayer)
minCloseBtn.MouseButton1Click:Connect(closePlayer)

playAllBtn.MouseButton1Click:Connect(function()
    if #userData.playlist > 0 then
        userData.repeatMode = "all"
        repeatBtn.Text = "ğŸ”"
        repeatBtn.TextColor3 = colors.accent
        playMusic(userData.playlist[1])
        showNotification("Playing all!", colors.success, "â–¶ï¸")
    else
        showNotification("Playlist empty!", colors.danger, "âš ï¸")
    end
end)

clearPlaylistBtn.MouseButton1Click:Connect(function()
    if #userData.playlist > 0 then
        userData.playlist = {}
        updatePlaylistTab()
        showNotification("Cleared!", colors.danger, "ğŸ—‘ï¸")
    end
end)

-- Hover effects
local function addHoverEffect(button)
    local originalColor = button.BackgroundColor3
    button.MouseEnter:Connect(function()
        TweenService:Create(button, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(
            math.min(255, originalColor.R * 255 * 1.2),
            math.min(255, originalColor.G * 255 * 1.2),
            math.min(255, originalColor.B * 255 * 1.2)
        )}):Play()
    end)
    button.MouseLeave:Connect(function()
        TweenService:Create(button, TweenInfo.new(0.2), {BackgroundColor3 = originalColor}):Play()
    end)
end

addHoverEffect(playManualBtn)
addHoverEffect(stopBtn)
addHoverEffect(addPlaylistBtn)
addHoverEffect(openBoxBtn)
addHoverEffect(playAllBtn)
addHoverEffect(clearPlaylistBtn)

-- Draggable
local dragging, dragStart, startPos = false, nil, nil

headerFrame.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = true
        dragStart = input.Position
        startPos = mainFrame.Position
    end
end)

headerFrame.InputChanged:Connect(function(input)
    if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
        local delta = input.Position - dragStart
        mainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
    end
end)

headerFrame.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then dragging = false end
end)

minimizedFrame.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = true
        dragStart = input.Position
        startPos = minimizedFrame.Position
    end
end)

minimizedFrame.InputChanged:Connect(function(input)
    if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
        local delta = input.Position - dragStart
        minimizedFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
    end
end)

minimizedFrame.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then dragging = false end
end)

-- Welcome
wait(1)
showNotification("ğŸ‰ Music Player 3.0 Ready!", colors.accent, "ğŸµ")

print("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•")
print("ğŸµ MUSIC PLAYER 3.0 LOADED! ğŸµ")
print("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•")
print("âœ¨ Visualizer | â­ Playlist | ğŸ² Random")
print("ğŸ”€ Shuffle | ğŸ”„ Repeat | ğŸ“Š Stats")
print("ğŸµ Enjoy your music! ğŸµ")