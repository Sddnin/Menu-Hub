-- Mila Command UI for Roblox - Fixed Version
-- Created by Assistant

local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")
local Lighting = game:GetService("Lighting")
local TeleportService = game:GetService("TeleportService")

local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

-- Clean up existing GUI first
if playerGui:FindFirstChild("MilaCommandGUI") then
    playerGui.MilaCommandGUI:Destroy()
end

-- Variables for features
local noclipEnabled = false
local espEnabled = false
local infJumpEnabled = false
local flyEnabled = false
local originalWalkSpeed = 16
local originalJumpPower = 50
local noclipConnection = nil
local espConnection = nil
local infJumpConnection = nil
local flyConnection = nil
local currentCamera = workspace.CurrentCamera
local bodyVelocity = nil
local bodyAngularVelocity = nil
local savedPositions = {}
local visualEffects = {}
local originalGravity = workspace.Gravity
local antiAFKEnabled = false
local antiAFKConnection = nil

-- ESP Variables
local espFolder = Instance.new("Folder")
espFolder.Name = "ESPFolder"
espFolder.Parent = workspace

-- Create main ScreenGui
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "MilaCommandGUI"
screenGui.Parent = playerGui
screenGui.ResetOnSpawn = false
screenGui.IgnoreGuiInset = true

-- Main Frame
local mainFrame = Instance.new("Frame")
mainFrame.Name = "MainFrame"
mainFrame.Size = UDim2.new(0, 500, 0, 400)
mainFrame.Position = UDim2.new(0.5, -250, 0.5, -200)
mainFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
mainFrame.BorderSizePixel = 0
mainFrame.Parent = screenGui

-- Round corners
local mainCorner = Instance.new("UICorner")
mainCorner.CornerRadius = UDim.new(0, 10)
mainCorner.Parent = mainFrame

-- Shadow effect
local shadow = Instance.new("Frame")
shadow.Name = "Shadow"
shadow.Size = UDim2.new(1, 6, 1, 6)
shadow.Position = UDim2.new(0, -3, 0, -3)
shadow.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
shadow.BackgroundTransparency = 0.5
shadow.ZIndex = mainFrame.ZIndex - 1
shadow.Parent = mainFrame

local shadowCorner = Instance.new("UICorner")
shadowCorner.CornerRadius = UDim.new(0, 10)
shadowCorner.Parent = shadow

-- Header
local header = Instance.new("Frame")
header.Name = "Header"
header.Size = UDim2.new(1, 0, 0, 40)
header.Position = UDim2.new(0, 0, 0, 0)
header.BackgroundColor3 = Color3.fromRGB(50, 150, 255)
header.BorderSizePixel = 0
header.Parent = mainFrame

local headerCorner = Instance.new("UICorner")
headerCorner.CornerRadius = UDim.new(0, 10)
headerCorner.Parent = header

-- Make header bottom flat
local headerBottom = Instance.new("Frame")
headerBottom.Size = UDim2.new(1, 0, 0, 10)
headerBottom.Position = UDim2.new(0, 0, 1, -10)
headerBottom.BackgroundColor3 = Color3.fromRGB(50, 150, 255)
headerBottom.BorderSizePixel = 0
headerBottom.Parent = header

-- Title
local title = Instance.new("TextLabel")
title.Name = "Title"
title.Size = UDim2.new(1, -80, 1, 0)
title.Position = UDim2.new(0, 10, 0, 0)
title.BackgroundTransparency = 1
title.Text = "üåü Mila Command"
title.TextColor3 = Color3.fromRGB(255, 255, 255)
title.TextScaled = true
title.Font = Enum.Font.GothamBold
title.TextXAlignment = Enum.TextXAlignment.Left
title.Parent = header

-- Minimize button
local minimizeBtn = Instance.new("TextButton")
minimizeBtn.Name = "MinimizeButton"
minimizeBtn.Size = UDim2.new(0, 30, 0, 30)
minimizeBtn.Position = UDim2.new(1, -65, 0, 5)
minimizeBtn.BackgroundColor3 = Color3.fromRGB(255, 193, 7)
minimizeBtn.Text = "‚ûñ"
minimizeBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
minimizeBtn.TextScaled = true
minimizeBtn.Font = Enum.Font.GothamBold
minimizeBtn.BorderSizePixel = 0
minimizeBtn.Parent = header

local minimizeBtnCorner = Instance.new("UICorner")
minimizeBtnCorner.CornerRadius = UDim.new(0, 5)
minimizeBtnCorner.Parent = minimizeBtn

-- Close button
local closeBtn = Instance.new("TextButton")
closeBtn.Name = "CloseButton"
closeBtn.Size = UDim2.new(0, 30, 0, 30)
closeBtn.Position = UDim2.new(1, -30, 0, 5)
closeBtn.BackgroundColor3 = Color3.fromRGB(220, 53, 69)
closeBtn.Text = "‚ùå"
closeBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
closeBtn.TextScaled = true
closeBtn.Font = Enum.Font.Gotham
closeBtn.BorderSizePixel = 0
closeBtn.Parent = header

local closeBtnCorner = Instance.new("UICorner")
closeBtnCorner.CornerRadius = UDim.new(0, 5)
closeBtnCorner.Parent = closeBtn

-- Content frame
local contentFrame = Instance.new("Frame")
contentFrame.Name = "Content"
contentFrame.Size = UDim2.new(1, -20, 1, -60)
contentFrame.Position = UDim2.new(0, 10, 0, 50)
contentFrame.BackgroundTransparency = 1
contentFrame.Parent = mainFrame

-- Command input
local commandInput = Instance.new("TextBox")
commandInput.Name = "CommandInput"
commandInput.Size = UDim2.new(1, -80, 0, 35)
commandInput.Position = UDim2.new(0, 0, 1, -45)
commandInput.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
commandInput.Text = ""
commandInput.PlaceholderText = "Nh·∫≠p l·ªánh... (help ƒë·ªÉ xem t·∫•t c·∫£ l·ªánh)"
commandInput.PlaceholderColor3 = Color3.fromRGB(150, 150, 150)
commandInput.TextColor3 = Color3.fromRGB(255, 255, 255)
commandInput.TextScaled = true
commandInput.Font = Enum.Font.Gotham
commandInput.BorderSizePixel = 0
commandInput.Parent = contentFrame

local inputCorner = Instance.new("UICorner")
inputCorner.CornerRadius = UDim.new(0, 5)
inputCorner.Parent = commandInput

-- Execute button
local executeBtn = Instance.new("TextButton")
executeBtn.Name = "ExecuteButton"
executeBtn.Size = UDim2.new(0, 70, 0, 35)
executeBtn.Position = UDim2.new(1, -70, 1, -45)
executeBtn.BackgroundColor3 = Color3.fromRGB(40, 167, 69)
executeBtn.Text = "Ch·∫°y"
executeBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
executeBtn.TextScaled = true
executeBtn.Font = Enum.Font.GothamBold
executeBtn.BorderSizePixel = 0
executeBtn.Parent = contentFrame

local executeBtnCorner = Instance.new("UICorner")
executeBtnCorner.CornerRadius = UDim.new(0, 5)
executeBtnCorner.Parent = executeBtn

-- Output frame
local outputFrame = Instance.new("ScrollingFrame")
outputFrame.Name = "OutputFrame"
outputFrame.Size = UDim2.new(1, 0, 1, -55)
outputFrame.Position = UDim2.new(0, 0, 0, 0)
outputFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
outputFrame.BorderSizePixel = 0
outputFrame.ScrollBarThickness = 8
outputFrame.ScrollBarImageColor3 = Color3.fromRGB(100, 100, 100)
outputFrame.CanvasSize = UDim2.new(0, 0, 0, 0)
outputFrame.Parent = contentFrame

local outputCorner = Instance.new("UICorner")
outputCorner.CornerRadius = UDim.new(0, 5)
outputCorner.Parent = outputFrame

-- Output text
local outputText = Instance.new("TextLabel")
outputText.Name = "OutputText"
outputText.Size = UDim2.new(1, -10, 0, 1000)
outputText.Position = UDim2.new(0, 5, 0, 5)
outputText.BackgroundTransparency = 1
outputText.Text = "üí´ Mila Command - Phi√™n b·∫£n n√¢ng cao!\n‚ú® G√µ 'help' ƒë·ªÉ xem danh s√°ch l·ªánh ƒë·∫ßy ƒë·ªß\nüöÄ UI ƒë√£ s·∫µn s√†ng ƒë·ªÉ s·ª≠ d·ª•ng!"
outputText.TextColor3 = Color3.fromRGB(200, 200, 200)
outputText.TextSize = 12
outputText.Font = Enum.Font.Gotham
outputText.TextXAlignment = Enum.TextXAlignment.Left
outputText.TextYAlignment = Enum.TextYAlignment.Top
outputText.TextWrapped = true
outputText.Parent = outputFrame

-- COMMAND FUNCTIONS

-- No Fog
local function setNoFog(enabled)
    if enabled then
        Lighting.FogEnd = 100000
        Lighting.FogStart = 0
    else
        Lighting.FogEnd = 1000
        Lighting.FogStart = 0
    end
end

-- Fullbright
local function setFullbright(enabled)
    if enabled then
        Lighting.Brightness = 2
        Lighting.ClockTime = 14
        Lighting.FogEnd = 100000
        Lighting.GlobalShadows = false
        Lighting.OutdoorAmbient = Color3.fromRGB(128, 128, 128)
    else
        Lighting.Brightness = 1
        Lighting.ClockTime = 12
        Lighting.FogEnd = 1000
        Lighting.GlobalShadows = true
        Lighting.OutdoorAmbient = Color3.fromRGB(70, 70, 70)
    end
end

-- Noclip
local function setNoclip(enabled)
    noclipEnabled = enabled
    if enabled then
        noclipConnection = RunService.Stepped:Connect(function()
            if player.Character and player.Character:FindFirstChild("Humanoid") then
                for _, part in pairs(player.Character:GetChildren()) do
                    if part:IsA("BasePart") then
                        part.CanCollide = false
                    end
                end
            end
        end)
    else
        if noclipConnection then
            noclipConnection:Disconnect()
        end
        if player.Character then
            for _, part in pairs(player.Character:GetChildren()) do
                if part:IsA("BasePart") and part.Name ~= "HumanoidRootPart" then
                    part.CanCollide = true
                end
            end
        end
    end
end

-- Gravity
local function setGravity(value)
    if value then
        workspace.Gravity = value
    else
        workspace.Gravity = originalGravity
    end
end

-- Time
local function setTime(hour)
    if hour then
        Lighting.ClockTime = hour
    end
end

-- Position functions
local function savePosition(name)
    if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
        savedPositions[name] = player.Character.HumanoidRootPart.CFrame
        return true
    end
    return false
end

local function loadPosition(name)
    if savedPositions[name] and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
        player.Character.HumanoidRootPart.CFrame = savedPositions[name]
        return true
    end
    return false
end

-- Find Player
local function findPlayer(name)
    for _, p in pairs(Players:GetPlayers()) do
        if string.lower(p.Name):find(string.lower(name)) or string.lower(p.DisplayName):find(string.lower(name)) then
            return p
        end
    end
    return nil
end

-- ESP
local function createESP(targetPlayer)
    if not targetPlayer.Character or not targetPlayer.Character:FindFirstChild("HumanoidRootPart") then
        return
    end

    local char = targetPlayer.Character
    local rootPart = char.HumanoidRootPart

    local billboard = Instance.new("BillboardGui")
    billboard.Name = targetPlayer.Name .. "_ESP"
    billboard.Adornee = rootPart
    billboard.Size = UDim2.new(0, 200, 0, 50)
    billboard.StudsOffset = Vector3.new(0, 3, 0)
    billboard.AlwaysOnTop = true
    billboard.Parent = espFolder

    local frame = Instance.new("Frame")
    frame.Size = UDim2.new(1, 0, 1, 0)
    frame.BackgroundTransparency = 0.5
    frame.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
    frame.BorderSizePixel = 0
    frame.Parent = billboard

    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 5)
    corner.Parent = frame

    local nameLabel = Instance.new("TextLabel")
    nameLabel.Size = UDim2.new(1, 0, 0.6, 0)
    nameLabel.BackgroundTransparency = 1
    nameLabel.Text = targetPlayer.Name
    nameLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    nameLabel.TextScaled = true
    nameLabel.Font = Enum.Font.GothamBold
    nameLabel.Parent = frame

    local distanceLabel = Instance.new("TextLabel")
    distanceLabel.Size = UDim2.new(1, 0, 0.4, 0)
    distanceLabel.Position = UDim2.new(0, 0, 0.6, 0)
    distanceLabel.BackgroundTransparency = 1
    distanceLabel.Text = "0 studs"
    distanceLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
    distanceLabel.TextScaled = true
    distanceLabel.Font = Enum.Font.Gotham
    distanceLabel.Parent = frame

    return billboard, distanceLabel
end

local function setESP(enabled)
    if enabled then
        espConnection = RunService.Heartbeat:Connect(function()
            for _, targetPlayer in pairs(Players:GetPlayers()) do
                if targetPlayer ~= player and targetPlayer.Character and targetPlayer.Character:FindFirstChild("HumanoidRootPart") then
                    local existingESP = espFolder:FindFirstChild(targetPlayer.Name .. "_ESP")
                    if not existingESP then
                        createESP(targetPlayer)
                    else
                        local billboard = existingESP
                        local distanceLabel = billboard.Frame:GetChildren()[3]
                        if player.Character and player.Character:FindFirstChild("HumanoidRootPart") and distanceLabel then
                            local distance = (player.Character.HumanoidRootPart.Position - targetPlayer.Character.HumanoidRootPart.Position).Magnitude
                            distanceLabel.Text = math.floor(distance) .. " studs"
                        end
                    end
                end
            end
        end)
    else
        if espConnection then
            espConnection:Disconnect()
        end
        espFolder:ClearAllChildren()
    end
end

-- Server Hop
local function serverHop()
    local success, result = pcall(function()
        local Http = game:GetService("HttpService")
        local TeleportService = game:GetService("TeleportService")
        local Api = "https://games.roblox.com/v1/games/"
        
        local _place = game.PlaceId
        local _servers = Api.._place.."/servers/Public?sortOrder=Asc&limit=100"
        
        local function ListServers(cursor)
            local Raw = game:HttpGet(_servers .. ((cursor and "&cursor="..cursor) or ""))
            return Http:JSONDecode(Raw)
        end
        
        local Server, Next; repeat
            local Servers = ListServers(Next)
            Server = Servers.data[1]
            Next = Servers.nextPageCursor
        until Server
        
        if Server then
            TeleportService:TeleportToPlaceInstance(_place, Server.id, player)
            return true
        end
        return false
    end)
    
    return success
end

-- Anti AFK
local function setAntiAFK(enabled)
    if enabled then
        antiAFKEnabled = true
        antiAFKConnection = game:GetService("RunService").Heartbeat:Connect(function()
            if antiAFKEnabled then
                local VirtualUser = game:service("VirtualUser")
                VirtualUser:CaptureController()
                VirtualUser:ClickButton2(Vector2.new())
            end
        end)
    else
        antiAFKEnabled = false
        if antiAFKConnection then
            antiAFKConnection:Disconnect()
            antiAFKConnection = nil
        end
    end
end

-- Infinite Jump
local function setInfiniteJump(enabled)
    if enabled then
        infJumpConnection = UserInputService.JumpRequest:Connect(function()
            if player.Character and player.Character:FindFirstChild("Humanoid") then
                player.Character.Humanoid:ChangeState(Enum.HumanoidStateType.Jumping)
            end
        end)
    else
        if infJumpConnection then
            infJumpConnection:Disconnect()
        end
    end
end

-- Update output text size
local function updateOutputSize()
    local textService = game:GetService("TextService")
    local textSize = textService:GetTextSize(outputText.Text, 12, Enum.Font.Gotham, Vector2.new(outputText.AbsoluteSize.X, math.huge))
    outputText.Size = UDim2.new(1, -10, 0, math.max(textSize.Y + 10, outputFrame.AbsoluteSize.Y))
    outputFrame.CanvasSize = UDim2.new(0, 0, 0, textSize.Y + 20)
end

-- Add output function
local function addOutput(text)
    outputText.Text = outputText.Text .. "\n> " .. text
    updateOutputSize()
    outputFrame.CanvasPosition = Vector2.new(0, outputFrame.CanvasSize.Y.Offset)
end

-- Command processor
local function processCommand(cmd)
    local args = {}
    for word in cmd:gmatch("%S+") do
        table.insert(args, word)
    end
    
    local command = string.lower(args[1] or "")
    
    if command == "help" or command == "h" then
        addOutput("üìã L·ªÜNH C∆† B·∫¢N:")
        addOutput("fb/unfb - Fullbright | nc/unnc - Noclip")
        addOutput("sp [s·ªë]/unsp - Speed | wsp [s·ªë]/unwsp - WalkSpeed") 
        addOutput("jp [s·ªë]/unjp - Jump | es/unes - ESP")
        addOutput("tp [t√™n] - Teleport | v [t√™n]/unv - View")
        addOutput("infj/uninfj - Infinite Jump")
        addOutput("nofog/unfog - No Fog | grty [s·ªë]/ungrty - Gravity")
        addOutput("time [0-24] - Set Time | rejoin - Rejoin")
        addOutput("sho - Server Hop | afk - Anti AFK")
        
    elseif command == "fb" or command == "fullbright" then
        setFullbright(true)
        addOutput("‚úÖ Fullbright ƒë√£ B·∫¨T")
        
    elseif command == "unfb" then
        setFullbright(false)
        addOutput("‚ùå Fullbright ƒë√£ T·∫ÆT")
        
    elseif command == "nc" or command == "noclip" then
        setNoclip(true)
        addOutput("‚úÖ Noclip ƒë√£ B·∫¨T")
        
    elseif command == "unnc" then
        setNoclip(false)
        addOutput("‚ùå Noclip ƒë√£ T·∫ÆT")
        
    elseif command == "sp" or command == "speed" then
        local speed = tonumber(args[2]) or 50
        if player.Character and player.Character:FindFirstChild("Humanoid") then
            player.Character.Humanoid.WalkSpeed = speed
            addOutput("‚ö° Speed ƒë·∫∑t th√†nh " .. speed)
        end
        
    elseif command == "unsp" then
        if player.Character and player.Character:FindFirstChild("Humanoid") then
            player.Character.Humanoid.WalkSpeed = originalWalkSpeed
            addOutput("‚ùå Speed ƒë√£ reset")
        end
        
    elseif command == "wsp" or command == "walkspeed" then
        local speed = tonumber(args[2]) or 16
        if player.Character and player.Character:FindFirstChild("Humanoid") then
            player.Character.Humanoid.WalkSpeed = speed
            addOutput("üö∂ WalkSpeed ƒë·∫∑t th√†nh " .. speed)
        end
        
    elseif command == "unwsp" then
        if player.Character and player.Character:FindFirstChild("Humanoid") then
            player.Character.Humanoid.WalkSpeed = 16
            addOutput("‚ùå WalkSpeed ƒë√£ reset")
        end
        
    elseif command == "jp" or command == "jump" then
        local jumpPower = tonumber(args[2]) or 100
        if player.Character and player.Character:FindFirstChild("Humanoid") then
            player.Character.Humanoid.JumpPower = jumpPower
            addOutput("ü¶ò Jump Power ƒë·∫∑t th√†nh " .. jumpPower)
        end
        
    elseif command == "unjp" then
        if player.Character and player.Character:FindFirstChild("Humanoid") then
            player.Character.Humanoid.JumpPower = originalJumpPower
            addOutput("‚ùå Jump Power ƒë√£ reset")
        end
        
    elseif command == "es" or command == "esp" then
        setESP(true)
        addOutput("‚úÖ ESP ƒë√£ B·∫¨T")
        
    elseif command == "unes" then
        setESP(false)
        addOutput("‚ùå ESP ƒë√£ T·∫ÆT")
        
    elseif command == "tp" or command == "teleport" then
        if args[2] then
            local targetPlayer = findPlayer(args[2])
            if targetPlayer and targetPlayer.Character and targetPlayer.Character:FindFirstChild("HumanoidRootPart") then
                if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
                    player.Character.HumanoidRootPart.CFrame = targetPlayer.Character.HumanoidRootPart.CFrame * CFrame.new(0, 0, 3)
                    addOutput("üìç ƒê√£ teleport ƒë·∫øn " .. targetPlayer.Name)
                end
            else
                addOutput("‚ùå Kh√¥ng t√¨m th·∫•y ng∆∞·ªùi ch∆°i: " .. args[2])
            end
        else
            addOutput("‚ùå C√°ch d√πng: tp [t√™n ng∆∞·ªùi ch∆°i]")
        end
        
    elseif command == "v" or command == "view" then
        if args[2] then
            local targetPlayer = findPlayer(args[2])
            if targetPlayer and targetPlayer.Character and targetPlayer.Character:FindFirstChild("Humanoid") then
                currentCamera.CameraSubject = targetPlayer.Character.Humanoid
                addOutput("üëÄ ƒêang xem " .. targetPlayer.Name)
            else
                addOutput("‚ùå Kh√¥ng t√¨m th·∫•y ng∆∞·ªùi ch∆°i: " .. args[2])
            end
        else
            addOutput("‚ùå C√°ch d√πng: v [t√™n ng∆∞·ªùi ch∆°i]")
        end
        
    elseif command == "unv" then
        if player.Character and player.Character:FindFirstChild("Humanoid") then
            currentCamera.CameraSubject = player.Character.Humanoid
            addOutput("‚ùå ƒê√£ ng·ª´ng xem")
        end
        
    elseif command == "infj" then
        setInfiniteJump(true)
        addOutput("‚úÖ Infinite Jump ƒë√£ B·∫¨T")
        
    elseif command == "uninfj" then
        setInfiniteJump(false)
        addOutput("‚ùå Infinite Jump ƒë√£ T·∫ÆT")
        
    elseif command == "nofog" then
        setNoFog(true)
        addOutput("‚úÖ No Fog ƒë√£ B·∫¨T")
        
    elseif command == "unfog" then
        setNoFog(false)
        addOutput("‚ùå No Fog ƒë√£ T·∫ÆT")
        
    elseif command == "grty" or command == "gravity" then
        local gravity = tonumber(args[2]) or 50
        setGravity(gravity)
        addOutput("üåç Gravity ƒë·∫∑t th√†nh " .. gravity)
        
    elseif command == "ungrty" then
        setGravity()
        addOutput("‚ùå Gravity ƒë√£ reset")
        
    elseif command == "time" then
        local hour = tonumber(args[2])
        if hour and hour >= 0 and hour <= 24 then
            setTime(hour)
            addOutput("‚è∞ Th·ªùi gian ƒë·∫∑t th√†nh " .. hour .. ":00")
        else
            addOutput("‚ùå Gi·ªù ph·∫£i t·ª´ 0-24")
        end
        
    elseif command == "rejoin" then
        addOutput("üîÑ ƒêang rejoin...")
        TeleportService:Teleport(game.PlaceId, player)
        
    elseif command == "sho" or command == "serverhop" then
        addOutput("üåê ƒêang t√¨m server kh√°c...")
        if serverHop() then
            addOutput("‚úÖ ƒêang chuy·ªÉn server...")
        else
            addOutput("‚ùå Kh√¥ng th·ªÉ server hop")
        end
        
    elseif command == "afk" then
        if not antiAFKEnabled then
            setAntiAFK(true)
            addOutput("‚úÖ Anti AFK ƒë√£ B·∫¨T")
        else
            setAntiAFK(false)
            addOutput("‚ùå Anti AFK ƒë√£ T·∫ÆT")
        end
        
    else
        addOutput("‚ùå L·ªánh kh√¥ng h·ª£p l·ªá: " .. command)
        addOutput("üí° G√µ 'help' ƒë·ªÉ xem danh s√°ch l·ªánh")
    end
end

-- Variables for dragging
local dragging = false
local dragStart = nil
local startPos = nil
local isMinimized = false
local originalSize = mainFrame.Size

-- Dragging functionality
header.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = true
        dragStart = input.Position
        startPos = mainFrame.Position
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
        local delta = input.Position - dragStart
        mainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
    end
end)

UserInputService.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = false
    end
end)

-- Minimize functionality
minimizeBtn.MouseButton1Click:Connect(function()
    local tween
    if isMinimized then
        tween = TweenService:Create(mainFrame, TweenInfo.new(0.3, Enum.EasingStyle.Quad), {Size = originalSize})
        minimizeBtn.Text = "‚àí"
        contentFrame.Visible = true
        isMinimized = false
    else
        tween = TweenService:Create(mainFrame, TweenInfo.new(0.3, Enum.EasingStyle.Quad), {Size = UDim2.new(0, 500, 0, 40)})
        minimizeBtn.Text = "+"
        contentFrame.Visible = false
        isMinimized = true
    end
    tween:Play()
end)

-- Close functionality
closeBtn.MouseButton1Click:Connect(function()
    setNoclip(false)
    setESP(false)
    setInfiniteJump(false)
    setAntiAFK(false)
    
    local tween = TweenService:Create(mainFrame, TweenInfo.new(0.3, Enum.EasingStyle.Quad), {
        Size = UDim2.new(0, 0, 0, 0),
        Position = UDim2.new(0.5, 0, 0.5, 0)
    })
    tween:Play()
    tween.Completed:Connect(function()
        screenGui:Destroy()
    end)
end)

-- Execute command functionality
executeBtn.MouseButton1Click:Connect(function()
    local command = commandInput.Text
    if command ~= "" then
        addOutput("üìù " .. command)
        processCommand(command)
        commandInput.Text = ""
    else
        addOutput("‚ö†Ô∏è Vui l√≤ng nh·∫≠p l·ªánh!")
    end
end)

-- Enter key support
commandInput.FocusLost:Connect(function(enterPressed)
    if enterPressed then
        executeBtn.MouseButton1Click:Fire()
    end
end)

-- Hover effects
local function createHoverEffect(button, normalColor, hoverColor)
    button.MouseEnter:Connect(function()
        TweenService:Create(button, TweenInfo.new(0.2), {BackgroundColor3 = hoverColor}):Play()
    end)
    
    button.MouseLeave:Connect(function()
        TweenService:Create(button, TweenInfo.new(0.2), {BackgroundColor3 = normalColor}):Play()
    end)
end

createHoverEffect(executeBtn, Color3.fromRGB(40, 167, 69), Color3.fromRGB(50, 180, 80))
createHoverEffect(minimizeBtn, Color3.fromRGB(255, 193, 7), Color3.fromRGB(255, 210, 50))
createHoverEffect(closeBtn, Color3.fromRGB(220, 53, 69), Color3.fromRGB(235, 70, 85))

-- Player left detection
Players.PlayerRemoving:Connect(function(leavingPlayer)
    local esp = espFolder:FindFirstChild(leavingPlayer.Name .. "_ESP")
    if esp then
        esp:Destroy()
    end
end)

-- Initialize output size
spawn(function()
    wait(0.5)
    updateOutputSize()
end)

-- Appearance animation
mainFrame.Size = UDim2.new(0, 0, 0, 0)
mainFrame.Position = UDim2.new(0.5, 0, 0.5, 0)

local appearTween = TweenService:Create(mainFrame, TweenInfo.new(0.5, Enum.EasingStyle.Back), {
    Size = UDim2.new(0, 500, 0, 400),
    Position = UDim2.new(0.5, -250, 0.5, -200)
})
appearTween:Play()

print("üåü Mila Command UI ƒë√£ t·∫£i th√†nh c√¥ng!")
addOutput("üöÄ S·∫µn s√†ng s·ª≠ d·ª•ng! G√µ 'help' ƒë·ªÉ xem l·ªánh!")
